\chapter{Покомпонентные методы и вычислительные оптимизации для решения обратных структурных задач гравиметрии и магнитометрии}

В третьей главе предложены покомпонентные методы типа Ньютона и типа Левенберга -- Марквардта для решения обратной задачи гравиметрии, а также вычислительная оптимизация методов типа Ньютона. Покомпонентный метод типа Ньютона предлагается для решения обратных задач в случае модели двухслойной среды, а метод, основанный на методе Левенберга -- Марквардта --- для модели многослойной среды. Первый параграф посвящен вычислительной оптимизации метода Ньютона и покомпонентному методу типа Ньютона. Во втором параграфе предложен покомпонентный метод типа Левенберга -- Марквардта. В третьем параграфе описаны использованные инструменты параллельного программирования. В четвертом параграфе обсуждаются результаты численного моделирования. Для задач, имеющих большой размер данных, приводятся результаты расчетов с использованием параллельных вычислений на многоядерных процессорах и графических ускорителях. В пятом параграфе приводится описание комплекса параллельных программ для выполнения на многоядерных процессорах и графических ускорителях NVIDIA.

\newpage
%\section{Вычислительная оптимизация метода Ньютона и покомпонентный метод типа Ньютона}

\section{Покомпонентный метод типа Ньютона и вычислительная оптимизация метода Ньютона}

{\bfseries 3.1.1. Покомпонентный метод типа Ньютона}

Используя особенности обратной задачи гравиметрии, предлагается покомпонентный метод, основанный на идее метода Ньютона.

Запишем исходное операторное уравнение (\ref{equ1}), $A: H\to H$:
$$A(u)=f,$$
где $A(u)=g\Delta\sigma\int_{a}^{b}\int_{c}^{d}K(x,y, x',y',u^k(x,y))dxdy$ --- интегральный оператор задачи гравиметрии (\ref{equ_grav2l}).

Итерации в методе Ньютона строятся по схеме
$$A'(u^k)(\Delta u^k)=-(A(u^k)-f),$$ где $\Delta u^k=u^{k+1}-u^k$.
То есть, для задачи гравиметрии
\begin{equation}\label{equ_grav_nwt}
g\Delta\sigma\int_{a}^{b}\int_{c}^{d}K'_u(x,y, x',y',u^k(x,y))\Delta u^k(x,y) dxdy=-\big[[A(u^k)](x',y')-f(x',y')\big].
\end{equation}
%{\remark В задаче гравиметиии на изменение гравитационного поля в правой части \eqref{equ_grav_nwt} наибольшее влияние оказывает отклонение искомой функции точного решения $z$ от асимптотической плоскости в точке $(x',y')$. }

Полагая $\Delta u^k(x,y)=\Delta u^k(x',y')=const$ относительно переменных интегрирования, запишем
\begin{equation}\label{comp_newt_meth_step1}
g\Delta\sigma(\Delta u^k(x',y'))\int_{a}^{b}\int_{c}^{d}K'_u(x,y, x',y',u^k(x,y)) dxdy\approx -\big[A(u(x',y'))-f(x',y')\big] .
\end{equation}
Таким образом, величина поправки $\Delta u^k$ может быть получена как
$$\Delta u^k=\bigg[[A(u)](x',y')-f(x',y')\bigg]\bigg/g\Delta\sigma\int_{a}^{b}\int_{c}^{d}K'_u(x,y, x',y',u^k(x,y)) dxdy.$$ 
Итерации осуществляются по схеме:
\begin{equation}\label{comp_newt_meth}
u^{k+1}(x',y')=u^k(x',y')-\frac{1}{\psi^k(x',y')}([A(u^k)](x',y')-f(x',y')),
\end{equation}
где $$\psi^k(x',y')=g\Delta\sigma\int_{a}^{b}\int_{c}^{d}K'_u(x,y, x',y',u^k(x,y)) dxdy.$$
Для решения некорректных задач гравиметрии, предлагается регуляризованный покомпонентный метод
\begin{equation}\label{rcomp_newt_meth}
u^{k+1}(x',y')=u^k(x',y')-\frac{1}{\psi^k(x',y')+\bar\alpha}([A(u^k)](x',y') + \alpha(u^k-u^0)-f_\delta(x',y')),
\end{equation}
где $\alpha, \bar{\alpha} > 0$ --- параметры регуляризации.

В дискретной записи итерационный процесс запишется
$$u_{m,l}^{k+1}=u_{m,l}^k-\frac{1}{\psi_{m,l}^k+\bar\alpha}([A_n(u^k)]_{m,l} + \alpha(u^k-u^0) -f_{m,l}),\quad 1\le m \le M, \quad 1\le l \le N,$$
где $$\psi_{m,l}^k=g\Delta\sigma\sum\limits_{i=1}^{M}\sum\limits_{j=1}^{N}
\Delta x\Delta y\frac{u_{ij}}{[(x_k-x'_j)^2+(y_l-y'_i)^2+(u_{ij})^2]^{3/2}}.$$
Эту сумму $\psi_{m,l}^k$ можно интерпретировать как сумму элементов $(m\times M + l)$-й строки матрицы производной $A'_n(u_n^k)$.

Покомпонентный метод позволяет восстанавливать значения функции $u$ в каждой точке $(x',y')$ области $D$, или, в дискретном случае, $\{m,l\}$-компоненты вектора $u$ --- отсюда название

{\bfseries\large Вывод.} Предложенный метод позволяет существенно упростить вычисления по сравнению с методом Ньютона. Вместо вычисления обратной матрицы в методе Ньютона можно вычислить вектор, состоящий из сумм элементов строк матрицы и использовать его компоненты для восстановления соответствующей компоненты вектора решения $u_n^k$. Это делает метод экономичным по памяти --- вместо хранения матрицы производной хранится вектор, а также по времени вычислений. Таким образом при больших сетках возможно обходиться небольшим количеством машинных ресурсов. Вычислительная сложность покомпонентного метода типа Ньютона для решения системы $n$ уравнений без учета сложности алгоритма вычисления $A_n(u_n^k)$ --- вектора аппрокисимированного интегрального оператора --- составляет $O(n)$, в отличие от метода Ньютона, где сложность алгоритма $O(n^2)$. Этот факт подтверждается вычислительными экспериментами в пункте 3.4.

\smallskip
{\bfseries 3.1.2. Вычислительная оптимизация метода Ньютона}

Для задач (\ref{equ_snle}), (\ref{equ_snle_mag}) можно отметить, что наибольшие значения подынтегральная функция $K$ принимает в точках $x$, $y$ равных или близких к $x'$ и $y'$. В конечномерном случае, матрица производной оператора задачи будет с диагональным преобладанием, элементы матриц $A'(u^0)$ (\ref{op_grav_disc_form}), (\ref{deriv_op_mag}) принимают наибольшие значения при малых значениях $(x-x')$ и $(y-y')$ (рис. \ref{fig:matrixscheme}).
%Однако при возрастании глубины $H$ асимптотической плоскости по сравнению с площадью $D$ --- размером сетки, выраженная <<ленточность>> матрицы производной оператора теряется.
\begin{figure}[H]
	\centering
	\includegraphics[height=10.0cm]{Matrix}
	\caption{Схема матрицы производной оператора $A$ в задачах грави- магнитометрии в двухслойной среде}
	\label{fig:matrixscheme}
\end{figure}

Поэтому в структурных обратных задачах грави- магнитометрии при небольших относительно размера сетки глубинах $H$ при решении итерационными методами без существенной потери точности можно не учитывать значения элементов, отстоящих от диагонали далее, чем на  $\beta$-ю часть  размерности матрицы производной, то есть те значения $a_{ij}$, для которых  $j \in \{i-h(\beta),..i+h(\beta)\} $, где $h(\beta)$ --- полуширина ленты матрицы, $i, j$ --- индекс элемента. Значение $\beta$ определяется из входных данных задачи и зависит от размера гравитационной или магнитной аномалии по отношению к величине сетки. Данный подход позволяет существенно уменьшить количество вычислительных операций, перейдя от плотно заполненных матриц к матрицам ленточного вида.

\newpage
\section{Покомпонентный метод типа Левенберга -- Марквардта для решения обратной задачи гравиметрии для модели многослойной среды}

Рассмотрим уравнение гравиметрии для модели многослойной среды. 

Предполагается, что нижнее полупространство состоит из нескольких слоев постоянной плотности $\Delta\sigma_l(l=1,..,L)$, разделенных искомыми поверхностями $S_l$, где $L$~--- число границ раздела (рис.~\ref{fig:multlayer}). Гравитационный эффект от такого полупространства равен сумме гравитационных эффектов от всех поверхностей раздела.
\begin{figure}[h]
	\centering
	\includegraphics[height=14.0cm]{MultilayerModel}
	\caption{Модель многослойной среды}
	\label{fig:multlayer}
\end{figure}
Пусть поверхности раздела задаются уравнениями $u_l(x,y)$, скачки плотности на них равны $\Delta\sigma_l$. поверхности имеют горизонтальные асимптотические плоскости $u_l=H_l$, т.е. $$\lim_{|x|,|y|\to\infty}|u_l(x,y)-H_l|=0.$$ Функции $u_l(x,y)$, $u=(u_1(x,y), .., u_L(x,y))$, описывающие искомые поверхности раздела сред, удовлетворяют операторному уравнению
\begin{equation}\label{equ_grav}
\begin{aligned}
A(u)=\sum_{l=1}^{L}g\Delta\sigma_l\frac{1}{4\pi}\iint_D\bigg\{\frac{1}{[(x-x')^2+(y-y')^2+u_l^2(x,y)]^{1/2}} \\
-\frac{1}{[(x-x')^2+(y-y')^2+H_l^2]^{1/2}}\bigg\}=f(x',y'),
\end{aligned}
\end{equation}
где $g$~---~гравитационная постоянная, $\Delta\sigma_l(l=1,..,L)$ скачки плотности, $f(x',y')=\sum_{l=1}^{L}F_l$~--- суммарное аномальное гравитационное поле. 

Предварительная обработка гравитационных данных с выделением аномального поля из измеренного выполняется по методике  \cite{MarPrut2003}. Задача является недоопределенной, так как мы ищем несколько функций $u_l(x,y)$ по заданной функции $f(x',y')$. Поэтому необходимо использовать весовые множители, которые могут быть найдены по формулам из \cite{AkMarMis2013}:
$$F=[F_1, F_2, ..., F_L]=(f_1, f_2, ..., f_{M\times L}, ..., f_{L\times M\times N})$$
$$\to (w_1, w_2, ..., w_{L\times M\times N}),$$
\begin{equation}\label{weght_fact_formula}
w_i=\frac{|f_i|^\beta}{\max\limits_{i} |f_i|^\beta}, \quad \beta>1,
\end{equation}
где $F_l (l=1, 2, ..., L)$ --- аномальные гравитационные поля, создаваемые гравитирующими массами, находящимися на соответствующих глубинах $H_l$ и разделенных границами раздела $S_l(l=1, 2, ..., L)$.

После дискретизации уравнения $(\ref{equ_grav})$ на сетке $n=M\times N$ с заданной правой частью $f(x',y')$ и аппроксимации интегрального оператора $A(u)$ по квадратурным формулам, получаем вектор правой части $F_n$ размера  $M\times N$, вектор решения $u_n=[u_1(x,y),..,u_L(x,y)]$ размерности $L\times M\times N$, полученный конкатенацией векторов решений, соответствующих $l$-й границе раздела, матрицу производной оператора $A'(u)$ размерности $(M\times N)\times(L\times M\times N)$, полученной приписыванием справа к матрице производной $A'(u^l)$ в точке $u^l$ матрицы $A'(u^{l+1})$, где
\begin{equation}\label{op_grav_disc_form_mult}
[A'(u_n^l)h_n]_{k,m}=g\Delta\sigma_l\sum\limits_{i=1}^{M}\sum\limits_{j=1}^{N}
\Delta x\Delta y\frac{u^l_{ij}h^l_{ij}}{[(x_k-x'_i)^2+(y_m-y'_j)^2+(u^l_{ij})^2]^{3/2}},
\end{equation} и систему нелинейных уравнений  
\begin{equation}\label{snl_equ}
A_n[u]=F_n.
\end{equation}

Для решения задач (\ref{equ_grav2l}), (\ref{equ_grav}) предлагается метод покомпонентного типа, основанный на идее метода Левенберга -- Марквардта. 

Для аппроксимации решения уравнения (\ref{equ_2lop}) метод Левенберга -- Марквардта (МЛМ) имеет вид:
\begin{equation}
u^{k+1}=u^k-\gamma[A'(u^k)^T A'(u^k)+\alpha I]^{-1} A'(u^k)^T(A(u^k)-f_\delta),
\end{equation}
где $A'(u^k)^T$ --- оператор, транспонированный к производной $A'(u)$, $\alpha>0$~--~параметр регуляризации, $\|f-f_\delta\|\le \delta.$
 
В работах В.В. Васина \cite{Vasin_2012}, \cite{VasPer_2011} был исследован метод Левенберга -- Марквардта
\begin{equation}\label{LM_Vasin}
u^{k+1}=u^k-\gamma[A'(u^k)^*A'(u^k)+\alpha I]^{-1} [A'(u^k)^*(A(u^k)-f_\delta)]
\end{equation} и его модифицированный вариант
\begin{equation}\label{LM_modif_Vasin}
u^{k+1}=u^k-\gamma[A'(u^0)^*A'(u^0)+\alpha I]^{-1} [A'(u^k)^*(A(u^k)-f_\delta)]
\end{equation} для решения регуляризованного уравнения
$$A'(u)^*(A(u)-f_\delta)+	\alpha (u-u^0)=0,$$
где $\gamma$ --- демпфирующий множитель, $u^0$ --- некоторое приближение к $u_\alpha$, $\alpha>0$. 
%На основании выводов, сделанных М.Ю. Кокуриным \cite{Kok_2010} о свойствах градиента $\Phi_\alpha '(u)$ тихоновского функционала $$\Phi_\alpha(u)=(1/2)(\|A(u)-f_\delta\|^2+\alpha\|u-\xi\|^2)$$ было установлено, что при выборе параметров $\bar{\alpha}$, $\alpha$, $\gamma$ имеет место сильная сходимость итераций (\ref{LM_Vasin}), (\ref{LM_modif_Vasin}) скорректированных в виде
%$$u^{k+1}=u^k-\gamma [A'(u^k)^*A'(u^k)+\bar\alpha I]^{-1}\Phi'_\alpha(u^k)$$
%и
%$$u^{k+1}=u^k-\gamma [A'(u^0)^*A'(u^0)+\bar\alpha I]^{-1}\Phi'_\alpha(u^k)$$
%соответственно к регуляризованному решению $u_\alpha$.

По аналогии с выводом покомпонентного метода типа Ньютона (\ref{comp_newt_meth}), выполним грубую аппроксимацию, вынеся $\Delta u_l(x',y')$ за знак интегрального оператора, как в (\ref{comp_newt_meth_step1}), и запишем итерационную последовательность восстановления каждой из неизвестных границ $u_l$
\begin{equation}\label{comp_lm_meth}
u_l^{k+1}=u_l^k-\gamma\frac{1}{\varphi_l+\bar{\alpha}}\Lambda[ A'(u_l^k)^T(A(u^k)-f_\delta)+\alpha (u_l^k-u_l^0)],
\end{equation}
где $l$ --- номер границы раздела, $l=1,..,L$, $\Lambda$ --- диагональный весовой оператора, у матрицы которого весовые множители  на главной диагонали, 
\begin{equation*}
\begin{aligned}
\varphi_l=\bigg[ g\Delta\sigma\int_{a}^{b}\int_{c}^{d}
K'_u(x',y', x, y, u_l^k(x,y))dx'dy'\bigg] \notag \\ \times\bigg[g\Delta\sigma\int_{a}^{b}\int_{c}^{d}K'_u(x,y, x',y',u_l^k(x,y))dxdy\bigg], 
\end{aligned}
\end{equation*} 
где $K'_u(x',y', x, y, u_l^k(x,y))$ --- функция ядра, транспонированного к ядру $K'_u(x,y,$ $ x',y',u^k(x,y))$. Величина $\varphi_l$ зависит от $u_l^k$.
Итерационный процесс (\ref{comp_lm_meth}) перепишем в дискретной форме
\begin{equation}\label{comp_lm_meth_disc}
u_{l,i}^{k+1}=u_{l,i}^k-\gamma\frac{1}{\varphi_{l,i}+\bar{\alpha}}w_{l,i}\bigg[ \{A'(u_l^k)^T(A(u^k)-f_\delta)\}_i+\alpha (u_{l,i}^k-u_{l,i}^0)\bigg],
\end{equation}
где $w_{l,i}$ --- $i$-й весовой множитель, зависящий от $l$-й границы раздела,
\begin{equation*}
\begin{aligned}
\varphi_{l,i}=\bigg[ g\Delta\sigma\sum\limits_{k=1}^{N}
\sum\limits_{m=1}^{M}
K'_u(x'_k,y'_m, \{x, y\}_i, u_{l,i}^k) \Delta x' \Delta y'\bigg] \notag \\ \times\bigg[g\Delta\sigma\sum\limits_{k=1}^{N}
\sum\limits_{m=1}^{M}K'_u(x_k,y_m, \{x',y'\}_i,u_l^k(x_k,y_m))\Delta x \Delta y\bigg]. 
\end{aligned}
\end{equation*}

{\bfseries\large Вывод.}
Преимущества покомпонентного метода типа Левенберга -- Марквардта в низкой вычислительной сложности и меньших затратах памяти, по сравнению с классическим методом Левенберга -- Марквардта. Здесь не требуется вычисления матрицы $A'(u^k)^T A'(u^k)+\alpha I$ и хранения ее в памяти, что значительно снижает потребление памяти. Это делает метод более экономичным в численных расчетах по сравнению с (\ref{LM_Vasin}), (\ref{LM_modif_Vasin}), где вычислительная сложность алгоритмов достигает $O(n^3)$ для систем уравнений с числом неизвестных $n$, в силу умножения матриц $A'(u^k)^T A'(u^k)$ и обращения матрицы $A'(u^k)^T A'(u^k)+\alpha I$. Вычислительная сложность (\ref{comp_lm_meth}) составляет $O(n^2)$ потому что самыми затратными по времени операциями являются вычисление элементов матрицы $A'(u^k)^T$ и матрично-векторные умножения. Таким образом, покомпонентный метод типа Левенберга -- Марквардта является достаточно экономичным алгоритмом решения обратной задачи гравиметрии в многослойной среде.

\newpage
\section{Использование параллельных вычислений}
Для исследования параллельных свойств и сравнения работы последовательных и параллельных алгоритмов вводятся некоторые характеристики. Основные --- это коэффициенты ускорения и эффективности:
\begin{equation}\nonumber
\begin{aligned}
S_m=\frac{T_1}{T_m},\\[16pt]
\quad E_m=\frac{S_m}{m},
\end{aligned}
\end{equation}
где 
$T_1$ --- время выполнения последовательного алгоритма на одном
процессорном ядре,
$T_m$ --- время выполнения параллельного алгоритма на $m$ ($m>1$) ядрах процессора.

$T_m$ представляет собой совокупность чистого времени счета 
и накладных расходов на создание и синхронизацию потоков исполнения $$T_m=T_c+T_o.$$

Число процессорных ядер $m$ соответствует упомянутому разбиению матрицы и векторов на $m$ фрагментов.

В общем случае эффективность распараллеливания $E_m$ меняется в пределах $0<E_m<1$. В идеальном случае при равномерной и сбалансированной загрузке процессорных ядер и минимальном времени на накладные расходы $E_m$ близко к единице, но при решении практических задач  она уменьшается за счет накладных расходов и дисбаланса нагрузки.

Oсновной целью при построении параллельных алгоритмов является получение максимального ускорения и эффективности:
\begin{equation}\nonumber
\begin{aligned}
S_m \rightarrow m, \\[16pt]
E_m \rightarrow 1.
\end{aligned}
\end{equation}

Главными условиями высокой эффективности являются:

1) равномерная загрузка процессорных ядер (отсутствие простоев);

2) масштабируемость параллельного алгоритма, т.е. возможность ускорения вычислений
пропорционально увеличению числа используемых процессорных ядер.

В качестве инструментов для создания параллельных программ автором использовались средства OpenMP в совокупности с компилятором Intel C++ Compiler и CUDA. Эти технологии общедоступны, так как многоядерные процессоры Intel и видеокарты NVIDIA распространены повсеместно и часто составляют аппаратное обеспечение современных ПК. 

Основную часть вычисления рассмотренных методов составляют операции линейной алгебры: матрично-векторные операции, матричные умножения и т.д. Распараллеливание вычислений производится путем разбиения матриц и векторов на горизонтальные блоки, количество которых соответствует числу ядер процессора или блоков видеокарты.

{\bfseries 3.3.1.} При создании кода параллельной программы OpenMP используются директивы \#pragma omp --- указания компилятору, какой участок программы будет выполняться параллельно (рис.~\ref{fig:omp}\footnote{Рисунок взят из интернет-ресурса Intel Developer Zone.}). Особенность выполнения параллельной OpenMP программы в блоке действия директивы \#pragma omp parallel в создании мастер-потока (\textins{master}), раздающего команды подчиненным ему потокам (\textit{slaves}). Эти команды заключаются, в основном, в раздаче фрагментов данных каждому потоку, включая мастер-поток, и в синхронизации результатов. 
\begin{figure}
	\centering
	\includegraphics[width=0.9\textwidth]{omp}
	\caption{Принцип работы потоков в OpenMP}
	\label{fig:omp}
\end{figure}

{\bfseries 3.3.2.} Технология CUDA для вычисления на видеокартах NVIDIA имеет свои особенности. Видеокарта предствляет собой периферийное устройство, при подключении к хост-машине (ПК) инициализируются тысячи потоков --- ядер. Поэтому при написании параллельного CUDA-кода требуется четко разграничивать пространство действия центрального процессора (\textit{host}) и видеокарты (\textit{ device}). Задачей кода для \textit{host} требуется инициализация входных данных, запуск подпрограмм для видеокарты на тех участках кода, где требуется распараллеливание. Программный код для \textit{device} состоит из специальных подпрограмм --- ядерных функций, выполняющихся непосредственно на видеокарте. Ядерная функция выполняется каждым ядром графического процессора внутри блока, все блоки соcтавляют вычислительную сетку \textit{grid}. Каждый из блоков имеет свой уникальный\textit{id} в пределах \textit{grid}, каждое ядро имеет свой уникальный \textit{id} в пределах свого блока (рис.~\ref{fig:cuda}\footnote{Рисунок взят из интернет-журнала Xakep.}).  

\begin{figure}
	\centering
	\includegraphics[width=0.7\textwidth]{cuda}
	\caption{Иерархия компонентов вычислительной сетки GPU}
	\label{fig:cuda}
\end{figure}

{\bfseries 3.3.3.} Параллельные алгоритмы для решения (\ref{equ_grav}) были численно реализованы на многоядерном процессоре Intel Xeon и на графических ускорителях NVIDIA Tesla, являющихся вычислительными компонентами суперкомпьютера <<Уран>>, установленного в Институте математики и механики УрО РАН. Параллельные программы для запуска на процессоре Intel Xeon были разработаны с использованием технологии OpenMP и библиотеки Intel MKL library, программы для запуска на GPU были разработаны с использованием технологии CUDA и библиотеки CUBLAS. 

\newpage
\section{Решение модельных задач гравиметрии и магнитометрии на многопроцессорных системах}

{\bfseries 3.4.1. Решение задач гравиметрии и магнитометрии методами ньютоновского типа} 

Рассматривается эксперимент по восстановлению границы раздела в двухслойной среде методами ньютоновского типа, наискорейшего спуска и минимальных невязок с распараллеливанием вычислений. Решается модельная задача. 

{\bfseries Целью} эксперимента является сравнить методы по точности решения, в том числе, в случае возмущенной правой части, и временам выполнения. 

Точное решение уравнения гравиметрии, определяющее поверхность раздела сред (рис. \ref{fig:gravy_kiev2014_exact}), задается формулой
$$\hat{u}(x,y)=5-3.21e^{-(x/10.13-6.62)^6-(y/9.59-2.93)^6}-2.78e^{-(x/9.89-4.12)^6-(y/8.63-7.435)^6}$$ 
\begin{equation}\label{exact_exp3.4.1}
+3.19e^{-(x/9.89-4.82)^6-(y/8.72-4.335)^6}.
\end{equation}
%\begin{figure}
%	\centering
%	\includegraphics[width=\textwidth]{gravy_kiev2014}
%	\caption{Модельная поверхность (слева) и приближенное решение (справа) задачи гравиметрии}
%	\label{fig:gravy_kiev2014}
%\end{figure}
\begin{figure}[h]
	\centering
	\includegraphics[width=\textwidth]{gravy_kiev2014_exact}
	\caption{Модельная поверхность <<Две горки и впадина>>}
	\label{fig:gravy_kiev2014_exact}
\end{figure}
Поверхность задана на области $D=\{0\le x\le 270, 0\le y\le 300\}$, с асимптотической плоскостью $H=5$, размерами шагов сетки $\Delta x=\Delta y=0.3$, скачком плотности $\Delta\sigma=0.2$ г/см$^3$. Восстановлена поверхность раздела (рис. \ref{fig:gravy_kiev2014_app}).
\begin{figure}[h]
	\centering
	\includegraphics[width=\textwidth]{gravy_kiev2014_app}
	\caption{Восстановленная поверхность}
	\label{fig:gravy_kiev2014_app}
\end{figure}

Точное решение уравнения магнитометрии (рис. \ref{fig:magne_kiev2014_exact}), определяющее поверхность раздела сред, задается формулой $\eqref{form6.11}$.
%\begin{figure}[H]
%	\centering
%	\includegraphics[width=\textwidth]{magne_kiev2014}
%	\caption{Модельная поверхность (слева) и приближенное решение (справа) задачи магнитометрии}
%	\label{fig:magne_kiev2014}
%\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[width=\textwidth]{magne_kiev2014_exact}
	\caption{Модельная поверхность <<Две горки>>}
	\label{fig:magne_kiev2014_exact}
\end{figure}
Поверхность задана на области $D=\{0\le x\le 300, 0\le y\le 300\}$, $H=5$, $\Delta x=\Delta y=0.3$, скачком вектора намагниченности $\Delta J=0.4$ А/м. Восстановлена поверхность раздела (рис. \ref{fig:magne_kiev2014_app}). 
\begin{figure}[H]
	\centering
	\includegraphics[width=0.95\textwidth]{magne_kiev2014_app}
	\caption{Приближенное решение задачи магнитометрии}
	\label{fig:magne_kiev2014_app}
\end{figure}

В таблицах \ref{table3.1}, \ref{table3.2} приведены результаты расчетов на многоядерном и графическом процессорах. Критерий останова итераций $\delta=\|u_e-u_a\|/\|u_e\|\le 0.025$, параметры регуляризации $\alpha=\bar{\alpha}=10^{-3}$, полуширина ленты матрицы производной $\beta=1/4$ для задачи гравиметрии и $\beta=1/5$ для задачи магнитометрии. Демпфирующий коэффициент $\gamma=1.2$ для покомпонетного метода Ньютона. Обозначение $\Delta=\|A(u^k)+\alpha(u^k-u^0)-f_\delta\|/\|f_\delta\|$ --- относительная норма регуляризованной невязки, $N$ --- число итераций, $T_1$ --- время счета последовательной программы, $T_8$ --- время счета программы на многоядерном процессоре Intel Xeon с использованием 8 ядер процессора, $S_8$ --- ускорение на 8 ядрах процессора, $S_{GPU}$ --- ускорение, полученное на видеокарте, $E_8$ --- эффективность. Для сетки 512 $\times$ 512 узлов размер матрицы  $A'_n(u^k)\approx 2.6*10^5\times2.6*10^5$.
\begin{table}[]
	\centering
	\renewcommand{\arraystretch}{1.5}
	\caption{Сравнение методов решения задачи гравиметрии на сетке 512 $\times$ 512}
	\label{table3.1}
	\begin{tabular}{|p{0.25\textwidth}|l|l|l|l|l|l|l|}
		\hline
		\multicolumn{1}{|c|}{Метод}        & \multicolumn{1}{c|}{$N$} &
		\multicolumn{1}{c|}{$\Delta$} & \multicolumn{1}{c|}{$T_1$} & \multicolumn{1}{c|}{$T_8$} &
		\multicolumn{1}{c|}{$T_{GPU}$} &
		\multicolumn{1}{c|}{$S_8$} & \multicolumn{1}{c|}{$S_{GPU}$}
		\\ \hline
		Метод Ньютона                      &  3        & 0.041                          &       64 мин                  &     8,82 мин &
		1 мин & 7.25 & 65 \\ \hline
		Модиф. метод Ньютона     &         5           & 0.042            & 55 мин                  & 7,5 мин.    &
		45 сек & 7.33 & 73             \\ \hline
		Метод минимальных невязок &  5               & 0.041                    & 50 мин  & 6.8 мин.  &  --   & 7.3 & ---            \\ \hline
		Метод Ньютона с ленточной матрицей &  4               & 0.041                    & 43 мин                  & 6.8 мин. & 30   & 7.41 & 86        \\ \hline
		Покомпонентный метод Ньютона &  6               & 0.041                    & 20 мин  & 2.82 мин.  &  11 сек   & 7.14 & 100            \\ \hline
	\end{tabular}
\end{table}
\begin{table}[]
	\centering
	\renewcommand{\arraystretch}{1.5}
	\caption{Сравнение методов решения задачи магнитометрии сетка 270 $\times$ 300}
	\label{table3.2}
	\begin{tabular}{|p{0.25\textwidth}|p{0.05\textwidth}|l|l|l|l|l|}
		\hline
		\multicolumn{1}{|c|}{Метод}        & \multicolumn{1}{c|}{$N$} &
		\multicolumn{1}{c|}{$\Delta$} &
		\multicolumn{1}{c|}{$T_1$} & \multicolumn{1}{c|}{$T_8$} &	\multicolumn{1}{c|}{$S_8$}&\multicolumn{1}{c|}{$E_8$} \\ \hline
		Метод Ньютона                      &   5             & 0.036                  &     15 мин                   &      2 мин 36 сек   
		& 6 &        0.75     \\ \hline
		Метод наискорейшего спуска &   4                    & 0.07               & 13 мин    & 1 мин 50 сек & 7.7 & 0.96   \\ \hline
		Метод минимальных невязок &   4                    & 0.08               & 13 мин    & 1 мин 50 сек & 7.7 & 0.96   \\ \hline
		Модифицированный метод Ньютона     &              5           & 0.037           & 5 мин                & 40 сек  & 7.75 & 0.96\\ \hline
		Метод Ньютона с ленточной матрицей &   5                    & 0.05               & 4 мин    & 35 сек & 7.5 & 0.93   \\ \hline
	\end{tabular}
\end{table}

%\begin{table}[H]
%	\centering
%	\caption{Оценка ускорения и эффективности параллельной программы <<Модифицированный метод Ньютона>>}
%	\label{table3.11}
%	\begin{tabular}{|c|p{0.05\textwidth}|p{0.05\textwidth}|p{0.05\textwidth}|}
%		\hline
%		\begin{tabular}[c]{@{}c@{}}Количество\\ ядер, $m$\end{tabular} & \multicolumn{1}{l|}{Время, $T_m$} & \multicolumn{1}{l|}{Ускорение, $S_m$} & \multicolumn{1}{l|}{Эффективность, $E_m$} \\ \hline
%		1                                          & 32                         & 1                          & 1                          \\ \hline
%		2                                          & 17                         & 1.88                        & 0.94                        \\ \hline
%		4                                          & 9                          & 3.5                        & 0.88                       \\ \hline
%		8                                          & 4                          & 8                          & 1                          \\ \hline
%	\end{tabular}
%\end{table}
%
%В таблице \ref{table3.11} приводятся данные по результатам распараллеливания программы, реализующей модифицированный метод Ньютона. За $T_m$ обозначено время выполнения на $m$ ядрах процессора, $S_m$ --- ускорение и $E_m$ --- эффективность.

Также были проведены эксперименты в случае с возмущенной правой частью. На $f$ был наложен гауссовский шум с математическим ожиданием $\mu_g=0.5$ и дисперсией $\sigma_g=0.7$ в случае гравитационного поля и $\mu_m=0.002$ и дисперсией $\sigma_m=0.001$ для магнитного поля. В первом случае шум составляет 16\%, во втором --- 6\%. На рис.\ref{fig:exp341_mmn_gravy_field}, \ref{fig:exp341_mmn_magne_field} изображены возмущенные поля, на рис.\ref{fig:exp341_mmn_gravy_app} и \ref{fig:exp341_mmn_gravy_app} восстановленные модифицированным методом Ньютона поверхности раздела сред для задач с возмущенными данными.
%\begin{figure}
%	\centering
%	\includegraphics[width=\textwidth]{exp341_mmn_gravy}
%	\caption{Гравитационное поле (слева) и приближенное решение (справа) ММН}
%	\label{fig:exp341_mmn_gravy}
%\end{figure}
%\begin{figure}
%	\centering
%	\includegraphics[width=\textwidth]{exp341_mmn_magne}
%	\caption{Магнитное поле (слева) и приближенное решение (справа) ММН}
%	\label{fig:exp341_mmn_magne}
%\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[width=\textwidth]{exp341_mmn_gravy_field}
	\caption{Гравитационное поле с шумом}
	\label{fig:exp341_mmn_gravy_field}
\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[width=\textwidth]{exp341_mmn_magne_field}
	\caption{Магнитное поле с шумом}
	\label{fig:exp341_mmn_magne_field}
\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[width=\textwidth]{exp341_mmn_gravy_app}
	\caption{Приближенное решение ММН задачи гравиметрии с шумом}
	\label{fig:exp341_mmn_gravy_app}
\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[width=\textwidth]{exp341_mmn_magne_app}
	\caption{Приближенное решение ММН задачи магнитометрии с шумом}
	\label{fig:exp341_mmn_magne_app}
\end{figure}

В таблицах \ref{table3.3}, \ref{table3.4} приведены результаты расчетов, где $\gamma$ --- параметр регулировки шага. Критерий останова --- относительная погрешность $\delta<10^{-1}$. 
\begin{table}[H]
	\centering
%	\renewcommand{\arraystretch}{1.5}
	\caption{Результаты для задачи гравитометрии с шумом}
	\label{table3.3}
	\begin{tabular}{|l|l|p{0.05\textwidth}|c|}
		\hline
		\multicolumn{1}{|c|}{Метод}                                                   & \multicolumn{1}{c|}{Параметры}              & \begin{tabular}[c]{@{}l@{}} $N$ \end{tabular} & $\Delta$ \\ \hline
		Метод Ньютона                                                                 & $\gamma = 0.2$, $\alpha=0.1$, $\bar\alpha=1$   & 5                   & 0.47     \\ \hline
		\begin{tabular}[c]{@{}l@{}}Модифицированный \\ метод Ньютона\end{tabular}     & $\gamma =0.2$, $\alpha=0.1$, $\bar\alpha=1$ & 5                   & 0.46     \\ \hline
		\begin{tabular}[c]{@{}l@{}}Метод Ньютона \\ с ленточной матрицей\end{tabular} & $\gamma =0.2$, $\alpha=0.1$, $\bar\alpha=1$ & 5                   & 0.46     \\ \hline
		\begin{tabular}[c]{@{}l@{}}Покомпонентный \\ метод Ньютона\end{tabular}     & $\gamma =1.2$, $\alpha=0.1$, $\bar\alpha=1$ & 7                   & 0.46     \\ \hline
	\end{tabular}
\end{table}

\begin{table}[H]
	\centering
%	\renewcommand{\arraystretch}{1.5}
	\caption{Результаты для задачи магнитометрии с шумом}
	\label{table3.4}
	\begin{tabular}{|l|l|p{0.05\textwidth}|c|}
		\hline
		\multicolumn{1}{|c|}{Метод}        & \multicolumn{1}{c|}{Параметры}              & \begin{tabular}[c]{@{}l@{}} $N$ \end{tabular} & $\Delta$ \\ \hline
		Метод Ньютона                      & $\gamma =1$, $\alpha=10^{-3}$, $\bar\alpha=0.1$   & 5                   & 0.49     \\ \hline
		\begin{tabular}[c]{@{}l@{}}Модифицированный \\ метод Ньютона\end{tabular}   & $\gamma = 1$, $\alpha=10^{-3}$, $\bar\alpha=0.1$ & 6                   & 0.49     \\ \hline
		\begin{tabular}[c]{@{}l@{}}Метод Ньютона \\ с ленточной матрицей\end{tabular} & $\gamma = 1$, $\alpha=10^{-3}$, $\bar\alpha=0.1$ & 5                   & 0.49     \\ \hline
	\end{tabular}
\end{table}

{\bfseries \large Вывод.} Покомпонентный метод типа Ньютона является самым экономичным по вычислительным затратам: в три раза быстрее РМН,  и в два раза быстрее метода Ньютона с ленточной матрицей. Исключение из матрицы производной оператора $A'(u^k)$ элементов, далеко отстоящих от диагонали, почти не влияет на количество итераций для достижения заданной точности метода Ньютона. Данные, полученные в ходе расчетов, не противоречат теоремам главы 2 о сходимости метода Ньютона. В частности, в задаче гравиметрии для методов понадобилось уменьшать параметр $\gamma$ для обеспечения сходимости итерационных процессов. Замена матрицы производной на ленточную не оказывает существенного влияния на скорость сходимости за счет почти не измененного параметра $N_1$ в оценках теоремы \ref{teo4.1}. На улучшение результата по сглаживанию шума оказал влияние подбор регуляризующих параметров $\bar{\alpha}, \alpha$. Проведенные эксперименты наглядно демонстрируют выгоду использования ПМН для решения обратных задач на больших сетках. Все алгоритмы обладают высокой степенью параллелизма, что дает почти $n$-кратное уменьшение времени счета программ при использовании $n$ ядер процессора. Из таблиц видно, что ускорение $S_m$ и эффективность $E_m$ близки к максимальным показателям.

%\newpage
%{\bfseries 3.4.2. Решение обратной структурной задачи гравиметрии модифицированным методом Ньютона и покомпонентным методом типа Ньютона} 
%
%Рассматривается эксперимент по восстановлению границы раздела в двухслойной среде модифицированным методом Ньютона (ММН) и покомпонентным методом типа Ньютона (ПМН) с распараллеливанием вычислений на многоядерном процессоре. Решается модельная задача.
%
%{\bfseries Целью} моделирования является сравнить модифицированный метод Ньютона и покомпонентный метод типа Ньютона по точности приближенных решений и по временам выполнения на больших сетках ($512 \times 512$).
%
% Точное решение уравнения гравиметрии, определяющее поверхность раздела сред, задается формулой (\ref{exact_exp3.4.1}) на области $D=\{0\le x\le 300, 0\le y\le 330\}$, с асимптотической плоскостью $  H=5$, размерами шагов сетки $\Delta x=\Delta y=0.33$, скачком плотности $\Delta\sigma=0.21$ г/см$^3$.
%%\begin{figure}[h]
%%	\centering
%%	\includegraphics[width=\textwidth]{gravy_kiev2015_methods}
%%	\caption{Решение, полученное ММН (слева) и решение, полученное ПМН (справа)}
%%	\label{fig:gravy_kiev2015_methods}
%%\end{figure}
%\begin{figure}[H]
%	\centering
%	\includegraphics[width=\textwidth]{gravy_kiev2015_methods_mmn}
%	\caption{Решение, полученное ММН}
%	\label{fig:gravy_kiev2015_methods_mmn}
%\end{figure}
%\begin{figure}[h]
%	\centering
%	\includegraphics[width=\textwidth]{gravy_kiev2015_methods_cmn}
%	\caption{Решение, полученное полученное ПМН}
%	\label{fig:gravy_kiev2015_methods_cmn}
%\end{figure}
%На рис. \ref{fig:gravy_kiev2015_methods_mmn}, \ref{fig:gravy_kiev2015_methods_cmn} изображены восстановленные поверхности обоими методами. Вычисления производились для сеток размерами $100\times 110$, $300\times 330$. Параметры регуляризации $\alpha=\bar{\alpha}=10^{-3}$, демпфирующий параметр $\gamma=1.8$ для покомпонентного метода Ньютона. Критерий останова итераций $\delta=\|u_e-u_a\|/\|u_e\|<10^{-2},$ $N$ --- число итераций, 
%$\Delta=\|A(u^k)+\alpha(u^k-u^0)-f_\delta\|/\|f_\delta\|$ --- относительная норма регуляризованной невязки, $T_1$ --- время счета последовательной программы, $T_8$ --- время счета программы на многоядерном процессоре Intel Xeon с использованием 8 ядер процессора, $S_8$ --- ускорение на 8 ядрах процессора, $E_8$ --- эффективность.
%
%\begin{table}[H]
%	\centering
%	%	\renewcommand{\arraystretch}{1.5}
%	\caption{Сравнение модифицированного и покомпонентного методов Ньютона}
%	\label{table3.5}
%	\begin{tabular}{|l|c|c|}
%		\hline
%		\textbf{Показатели}                                                        & \multicolumn{1}{l|}{\textbf{\begin{tabular}[c]{@{}l@{}}Модифицированный\\ метод Ньютона\end{tabular}}} & \multicolumn{1}{l|}{\textbf{\begin{tabular}[c]{@{}l@{}}Покомпонентный\\ метод типа Ньютона\end{tabular}}} \\ \hline
%		\begin{tabular}[c]{@{}l@{}}Число итераций,\\ $N$\end{tabular}              & 16                                                                                                     & 21                                                                                                        \\ \hline
%		\begin{tabular}[c]{@{}l@{}}Отн. норма\\ невязки, $\Delta$\end{tabular}     & 0.002                                                                                                  & 0.002                                                                                                     \\ \hline
%		\begin{tabular}[c]{@{}l@{}} Время, $T_1$ \\ на сетке 300$\times$330\end{tabular}          & 21 мин                                                                                                 & 11 мин                                                                                                    \\ \hline
%		\textbf{\begin{tabular}[c]{@{}l@{}}Время, $T_1$ \\ на сетке 512$\times$512\end{tabular}} & \textbf{61 мин}                                                                                        & \textbf{19 мин}                                                                                           \\ \hline
%		\textbf{\begin{tabular}[c]{@{}l@{}}Время, $T_8$ \\ на сетке 512$\times$512\end{tabular}} & \textbf{7 мин 50 сек}                                                                                  & \textbf{2 мин 33 сек}                                                                                     \\ \hline
%		Ускорение, $S_8$                                                                      & 7.82                                                                                                   & 7.45                                                                                                      \\ \hline
%		Эффективность, $E_8$                                                                      & 0.97                                                                                                   & 0.93                                                                                                      \\ \hline    
%	\end{tabular}
%\end{table}
%
%Также были проведены вычисления для возмущенной правой части из эксперимента 3.4.1. На рис. \ref{fig:exp342_mmn_noise}, \ref{fig:exp342_cmn_noise} изображены восстановленные поверхности обоими методами из возмущенной правой части. Результаты приводятся в таблице \ref{table3.6}. Критерием останова послужило условие $\Delta=\|A(u^k)+\alpha(u^k-u^0)-f_\delta\|/\|f_\delta\|<0.18$, $\delta=\|u_e-u_a\|/\|u_e\|<10^{-2}$.
%%\begin{figure}[h]
%%	\centering
%%	\includegraphics[width=\textwidth]{exp342_mmn_cmn_noise}
%%	\caption{Решение, полученное ММН (слева) и решение, полученное ПМН (справа)}
%%	\label{fig:exp342_mmn_cmn_noise}
%%\end{figure}
%\begin{figure}[H]
%	\centering
%	\includegraphics[width=\textwidth]{exp342_mmn_noise}
%	\caption{Решение, полученное ММН}
%	\label{fig:exp342_mmn_noise}
%\end{figure}
%\begin{figure}[H]
%	\centering
%	\includegraphics[width=\textwidth]{exp342_cmn_noise}
%	\caption{Решение, полученное ПМН}
%	\label{fig:exp342_cmn_noise}
%\end{figure}
%\begin{table}[h]
%	\centering
%	\renewcommand{\arraystretch}{1.5}
%	\caption{Сравнение ММН и ПМН для задачи с шумом}
%	\label{table3.6}
%	\begin{tabular}{|l|l|c|c|}
%		\hline
%		\multicolumn{1}{|c|}{Метод} & \multicolumn{1}{c|}{Параметры}              & $N$ & $\delta$ \\ \hline
%		ММН                         & $\gamma =0.4$, $\alpha=0.1$, $\bar\alpha=10$ & 38   & 0.22     \\ \hline
%		ПМН                         & $\gamma =1$, $\alpha=1$, $\bar\alpha=10$    & 7   & 0.078    \\ \hline
%	\end{tabular}
%\end{table}
%
%Размерность матрицы производной в модифицированном методе Ньютона $A'(u^0)$ при сетке $512\times512$ составляет $\approx 2.6 * 10^5\times 2.6 * 10^5$, что сильно увеличило время счета задачи методом ММН, в отличие от предыдущего эксперимента 3.4.1. 
%
%{\bfseries\large Вывод.} Проведенные эксперименты наглядно демонстрируют выгоду использования ПМН для решения обратных задач на больших сетках. На улучшение результата по сглаживанию шума оказал влияние подбор регуляризующих параметров $\bar{\alpha}, \alpha$. Также решение, полученное ПМН оказалось более <<сглаженным>>, чем ММН, что говорит о большей устойчивости к шуму.
% 

\newpage
{\bfseries 3.4.2. Решение структурной обратной задачи гравиметрии для модели многослойной среды} 

Рассматривается эксперимент по восстановлению границ раздела сред в многослойной среде (4 слоя с разной плотностью) в задаче гравиметрии на основе квазиреального аномального поля методами: регуляризованный Левенберга -- Марквардта (ЛМ) и покомпонентный типа Левенберга -- Марквардта (ПЛМ).

{\bfseries Целью} моделирования является сравнить регуляризованный метод Левенберга -- Марквардта и покомпонентный метод типа Левенберга -- Марквардта по качеству восстановленных решений, подтвердить экономичность покомпонентного метода экспериментами на больших сетках.

На рис. \ref{fig:field_sum_exact} и \ref{fig:field_gauss_noise22} изображено суммарное гравитационное поле и поле с гауссовским шумом 22\%, математическое ожидание $\mu=1$, величина дисперсии $\sigma=1.15$. Модельные поверхности раздела построены по аналогии с границами раздела из работы \cite{MarAkiMis2016}.
%\begin{figure}
%	\centering
%	\includegraphics[width=\textwidth]{field_sum_gauss_noise12}
%	\caption{Суммарное гравитационное поле и поле с шумом 22\% (мГал)}
%	\label{fig:field_sum_gauss_noise12}
%\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[width=0.9\textwidth]{field_sum_exact}
	\caption{Суммарное гравитационное поле без шума (мГал)}
	\label{fig:field_sum_exact}
\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[width=\textwidth]{field_gauss_noise22}
	\caption{Суммарное гравитационное gоле с шумом 22\% (мГал)}
	\label{fig:field_gauss_noise22}
\end{figure}

На рис. \ref{fig:exact_ver} изображены точные решения задачи. Асимптотические плоскости $H_1=8$ км, $H_2=15$ км и $H_3=30$ км. Скачки плотности $\Delta\sigma_1=0.2$ г/см$^3$, $\Delta\sigma_2=0.1$ г/см$^3$, $\Delta\sigma_3=0.1$ г/см$^3$. Шаги сетки $\Delta x=2$ км, $\Delta y=3$ км.
%\begin{figure}
%	\centering
%	\includegraphics[width=\textwidth]{exact_hor}
%	\caption{Точные решения $u_0(x,y)$, $u_1(x,y)$, $u_2(x,y)$}
%	\label{fig:exact_hor}
%\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[height=0.95\textheight]{exact_ver}
	\caption{Точные решения $u_0(x,y)$, $u_1(x,y)$, $u_2(x,y)$}
	\label{fig:exact_ver}
\end{figure}

При больших размерах сеток матрицы в методе ЛМ требуют для хранения значительных объемов памяти. Например, при числе границ раздела $L=3$, размере сетки $M=N=1000$, матрица $A'(u^k)^*A'(u^k)$ с данными типа двойной точности занимает примерно  67 055.2~Гб. Также необходимо отметить, что перемножение плотных матриц является вычислительно сложной задачей. Чтобы сократить объёмы требуемой памяти, было решено выполнять все матрично--векторные операции <<на лету>>: необходимый элемент матрицы вычисляется в момент умножения его на элемент вектора. Покажем это.

Предварительно сводим систему нелинейных уравнений (\ref{snl_equ}) к СЛАУ:
\begin{equation}\label{slae_equ}
B(u^k)u^{k+1}\equiv[A'(u^k)^*A'(u^k)+\alpha I]u^{k+1}=b,
\end{equation}
где $b\equiv[A'(u^k)^*A'(u^k)+\alpha I]u^k-\Lambda A'(u^k)^*(A(u^k)-f_\delta)$. Здесь получаем \\ $A'(u^k)^*(A(u^k)-f_\delta)$ и $[A'(u^k)^*A'(u^k)]u^k$ <<на лету>>. В соответствии с ассоциативностью умножения матриц, $[A'(u^k)^*A'(u^k)]u^k$ эквивалентно $A'(u^k)^*[A'(u^k)u^k]$, так, прием вычисления результата матрично-векторного умножения <<на лету>> позволяет избежать перемножения матриц, заменяя эту процедуру на двойное матрично-векторное умножение. Далее СЛАУ (\ref{slae_equ}) может быть решена итерационными методами градиентного типа, например, методом минимальных невязок  \cite{VasEre2009}, \cite{BachZhid1987}.

Для запуска на многоядерном процессоре Intel Xeon были использовались директивы \#pragma simd для векторизации в циклах и оптимизации с использованием средств компилятора Intel Xeon.

На рис.~\ref{fig:levmar} показаны восстановленные границы раздела методом ЛМ, на рис.~\ref{fig:clm} показаны восстановленные границы раздела методом ПЛМ.
\begin{figure}[H]
	\centering
	\includegraphics[height=0.95\textheight]{levmar_ver}
	\caption{Границы, восстановленные ЛМ $\tilde{u}_0(x,y)$, $\tilde{u}_1(x,y)$, $\tilde{u}_2(x,y)$}
	\label{fig:levmar}
\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[height=0.95\textheight]{clm_ver}
	\caption{Границы, восстановленные ПЛМ $\hat{u}_0(x,y)$, $\hat{u}_1(x,y)$, $\hat{u}_2(x,y)$}
	\label{fig:clm}
\end{figure}

Рис.~\ref{fig:noise_lm} и рис.~\ref{fig:noise_clm} показывают восстановленные границы раздела методами ЛМ и ПЛМ из гравитационного поля с шумом 22\%.
\begin{figure}[H]
	\centering
	\includegraphics[height=0.85\textheight]{lm_noise_ver}
	\caption{Границы, восстановленные ЛМ для данных с шумом $\tilde{u}_0(x,y)$, $\tilde{u}_1(x,y)$, $\tilde{u}_2(x,y)$}
	\label{fig:noise_lm}
\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[height=0.95\textheight]{clm_noise_ver}
	\caption{Границы, восстановленные ПЛМ для данных с шумом $\hat{u}_0(x,y)$, $\hat{u}_1(x,y)$, $\hat{u}_2(x,y)$}
	\label{fig:noise_clm}
\end{figure}
\begin{table}[]
	\centering
	\renewcommand{\arraystretch}{1.5}
	\caption{Относительные ошибки и время вычислений задачи без шума}
	\label{table3.8}
	\begin{tabular}{|l|c|l|l|l|l|l|l|l|l|l|}
		\hline
		\multicolumn{1}{|c|}{\multirow{2}{*}{\textbf{Метод}}} & \multirow{2}{*}{\textbf{$N$}} & \multirow{2}{*}{\textbf{$\delta_1$}} & \multirow{2}{*}{\textbf{$\delta_2$}} & \multirow{2}{*}{\textbf{$\delta_3$}} & \multicolumn{3}{c|}{\textbf{Сетка $10^2\times10^2$}}                                         & \multicolumn{3}{c|}{\textbf{Сетка $10^3\times10^3$}}                                                            \\ \cline{6-11} 
		\multicolumn{1}{|c|}{}                                &                               &                                      &                                      &                                      & \multicolumn{1}{c|}{\textbf{$T_1$}} & \multicolumn{1}{c|}{\textbf{$T_8$}} & \textbf{$T_n$} & \multicolumn{1}{c|}{\textbf{$T_1$}} & \multicolumn{1}{c|}{\textbf{$T_8$}} & \multicolumn{1}{c|}{\textbf{$T_n$}} \\ \hline
		ЛМ                                                    & 60                            & 0.052                                & 0.026                                & 0.051                                & \begin{tabular}[c]{@{}l@{}}4 м. \\ 6 с. \end{tabular}                       & \begin{tabular}[c]{@{}l@{}} 1 м. \\ 15 с.  \end{tabular}                 & 22 с.        & \begin{tabular}[c]{@{}l@{}}11 ч. \\ 40 м. \end{tabular}               & \begin{tabular}[c]{@{}l@{}} 1 ч. \\ 25 м.\end{tabular}                    & 35 м.                             \\ \hline
		ПЛМ                                                   & 20                            & 0.051                                & 0.035                                & 0.060                                & 33 с.                             & 16 с.                             & 3 с.         & \begin{tabular}[c]{@{}l@{}} 1 ч. \\ 12 м.   \end{tabular}                & 10 м.                             & 3 м.                              \\ \hline
	\end{tabular}
\end{table}

В таблице \ref{table3.8} представлены времена счета задачи гравиметрии в многослойной среде с тремя границами раздела с шумом и без шума методами ЛМ и ПЛМ на сетках размерности $100\times100$ и $10^3\times10^3$. Весовые множители получены из поля после предварительной обработки по формуле из  \cite{AkMarMis2013} с параметрами $\alpha=1$, $\beta=1.1$.  Для обоих методов использовались параметр регуляризации $\alpha=10^{-3}$ и демпфирующий множитель $\gamma=1$. Критерий останова итераций $\epsilon < 0.1$. Относительные погрешности $\delta_i=\|u_a-u_e\|/\|u_e\|$ для равнения точного $u_e$ и численного решения $u_a$ для каждой $i$~-й границы раздела (для данных без шума). В последних колонках: $T_1 $ время счета программы, запущенной на одном ядре Intel Xeon, $T_8$ время на восьми ядрах процессора Intel Xeon, $T_n$ время счета на ядрах графического ускорителя NVIDIA Tesla GPU для сеток $100\times100$ и $10^3\times10^3$. Как можно видеть, показатели ускореничя и эффекктивности близки к максимальным.

Результаты моделирования приведены в таблице \ref{table3.9}, параметр шага $\gamma=1$, параметры регуляризации $\alpha=0.1$, $\bar{\alpha}=1$, критерий останова $\Delta=\|A(u^k)+\alpha(u^k-u^0)-f_\delta\|/\|f_\delta\|<0.15$.
\begin{table}[H]
	\centering
	\renewcommand{\arraystretch}{1.5}
	\caption{Относительные ошибки для задачи с шумом}
	\label{table3.9}
	\begin{tabular}{|l|c|l|l|l|}
		\hline
		\textbf{Метод} & \textbf{$N$} & \textbf{$\delta_1$} & \textbf{$\delta_2$} & \textbf{$\delta_3$} \\ \hline
		ЛМ                                                    & 24                            & 0.048                                & 0.035                                & 0.059                                \\ \hline
		ПЛМ                                                   & 8                             & 0.048                                & 0.040                                & 0.068                                \\ \hline
	\end{tabular}
\end{table}

{\bfseries\large Вывод.} ПЛМ является более экономичным, по срвнению с классическим методом ЛМ. Программа, реализующая алгоритм ПЛМ, произвела вычисления примерно в десять раз быстрее, чем программа ЛМ. На рис. \ref{fig:levmar}, \ref{fig:clm} можно заметить, что с увеличением глубины поверхности становятся менее рельефными, по сравнению с точными границами. Это связано с особенностями формирования гравитационного поля: искривления поверхностей, расположенных далеко от поверхности Земли, оказывают меньшее влияние на изменения суммарного гравитационного поля. Использование покомпонентного метода типа Левенберга -- Марквардта позволяет избежать некоторых трудностей, возникающих при применении классического метода Левенберга -- Марквардта: обращение плохо обусловленных матриц, высокая вычислительная сложность и большие затраты памяти. Результаты численного моделирования показывают, что относительная норма невязки ПЛМ сходится к $\Delta$ за меньшее число итераций, чем классический регуляризованный метод ЛМ. Это можно связать с тем, что в задаче гравиметрии матрица производной оператора $A'(u^k)$ плохо обусловлена, что влечет значительное увеличение числа обусловленности матрицы $A'(u^k)^T*A'(u^k)$, используемой в методе Левенберга -- Марквардта. Оба метода показали высокую устойчивость к гауссовскому шуму. Для сеток большой размерности, когда данные не могут храниться в памяти целиком, целесообразно использование техники вычислений <<на лету>>.

\newpage
\section{Описание комплекса параллельных программ}

Для решения обратных структурных задач гравиметрии и магнитометрии о восстановлении раздела сред был разработан комплекс программ, позволяющий выполнять расчеты на основе входных данных гравитационного или магнитного поля и результатом работы программ является файл, описывающий границы раздела сред в трехмерном пространстве.

Комплекс представляет собой библиотеку с подпрограммами \textit{MyGeoLib} для специальных вычислений и набор программ для решения обратных задач гравиметрии и магнитометрии. В настоящее время можно решать следущие задачи:

1. структурная обратная задача гравиметрии о нахождении поверхности раздела для модели двухслойной среды;

2. структурная обратная задача магнитометрии о нахождении поверхности раздела для модели двухслойной среды;

3. структурная обратная задача гравиметрии о нахождении поверхности раздела для модели многослойной среды.

Для решения задачи из п.1. можно использовать программы:
\begin{itemize}
	\item регуляризованный метод Ньютона и модифицированный вариант (многоядерные процессоры, видеокарта);
	\item метод минимальной ошибки и модифицированный вариант (многоядерные процессоры);
	\item метод наискорейшего спуска и модифицированный вариант (многоядерные процессоры);
	\item метод минимальных невязок и модифицированный вариант (многоядерные процессоры);
	\item метод Ньютона с ленточной матрицей (многоядерные процессоры);
	\item покомпонентный метод Ньютона (многоядерные процессоры, видеокарта);
	\item покомпонентный метод Левенберга -- Марквардта (многоядерные процессоры, видеокарта).
\end{itemize} 

Для решения задачи из п.2. можно использовать программы:
\begin{itemize}
	\item регуляризованный метод Ньютона и модифицированный вариант (многоядерные процессоры, видеокарта);
	\item метод минимальной ошибки и модифицированный вариант (многоядерные процессоры);
	\item метод наискорейшего спуска и модифицированный вариант (многоядерные процессоры);
	\item метод минимальных невязок и модифицированный вариант (многоядерные процессоры);
	\item метод Ньютона с ленточной матрицей (многоядерные процессоры).
\end{itemize} 

Для решения задачи из п.3. можно использовать программу:
\begin{itemize}
	\item покомпонентный метод Левенберга -- Марквардта (многоядерные процессоры, видеокарта).
\end{itemize}

Создана специальная библиотека методов, которая позволила ускорить разработку и сделать ее более гибкой. Библиотека состоит из 3-х частей: общие процедуры (считывание геофизических данных из файла, печать данных в файл, и т.д.), математические процедуры (умножение матриц на вектор, вычисление норм векторов и т.д.), процедуры для задач гравиметрии и магнитометрии (вычисление интегрального оператора, производной оператора и т.д.). В основе разработки структуры библиотеки лежит процедурный подход. Это связано с тем, что данные представляют собой стандартные конструкции --- массивы, это обусловлено удобством написания параллельного кода.

В качестве языка программирования использовался язык С, для написания параллельного кода использовались библиотеки IntelMKL, OpenMP, CUDA и CUBLAS.

Комплекс программ размещен на суперкомпьютере <<Уран>>, запуск задач осуществляется с помощью команд системы SLURM. Каждая программа  располагается в отдельной папке (рис. \ref{fig:prog_complex}). В папках библиотеки \textit{MyGeoLib} \textit{Gravy} и \textit{Magne} содержатся файлы исходного кода с описаниями процедур вычисления оператора задач гравиметрии и магнитометрии, производных оператора, вычисления весовых множителей и т.д. В папке \textit{Math} находятся файлы с описанием математических подпрограмм, в папке \textit{Common} содержатся файлы исходного кода с описаниями процедур общего вида, например, чтение-запись в файл. Все процедуры библиотеки реализованы в двух вариантах: OpenMP и CUDA. 
\begin{figure}[h]
	\centering
	\includegraphics[width=\textwidth]{prog_complex}
	\caption{Структура комплекса}
	\label{fig:prog_complex}
\end{figure}

Для запуска программы следует перейти в папку нужной программы, где папки \textit{omp} и \textit{cuda} содержат версии программ для многоядерого процессора и видеокарты соответственно, и запустить исполняемый файл \textit{prog}. Пример запуска программы, использующей 8 ядер процессора, с выделением памяти 48000 Мб, на узле tesla4, ограничение по времени исполнения 20 минут:

srun --cpus-per-task=8 --mem=48000 -w tesla4 -t 20 prog.

Пример запуска программы на видеокарте:

srun --gres=gpu:1 ./prog

Выходными данными программ являются файлы с расширением .DAT, содержащие XYZ-описание двумерных сеточных функций. Интерпретация результатов может быть осуществлена с помощью картографического пакета Golden Software Surfer.

