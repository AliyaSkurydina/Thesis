\chapter{Построение параллельных алгоритмов, разработка комплекса программ для многоядерных процессоров, численные эксперименты}

Данная глава посвящена разработке параллельных алгоритмов на основе методов, предложенных в первых двух главах, их реализации в виде комплекса программ для  многоядерных процессоров и тестированию на синтетических и натурных данных.

\newpage
\section{Разработка параллельных алгоритмов}
На основе предложенных автором методов разработаны параллельные алгоритмы и программы для многоядерных процессоров с использованием технологии OpenMP и средств компилятора Intel C++ Compiler. Технология была выбрана по причине общедоступности многоядерных процессоров и возможности портирования разработанных программ на современные сопроцессоры Intel Xeon Phi.

В практических задачах типичным размером сетки является $n=10^3 \times 10^3$, поэтому значительное время занимает вычисление значений интегрального оператора и матрицы производных на каждой итерации. Распараллеливание проводится путем разделения вектора решения и матрицы производных горизонтальными полосами на блоки, число которых соответствует числу процессорных ядер. Основной поток исполнения кроме выполнения своего фрагмента расчетов занимается созданием и синхронизацией дополнительных OpenMP-потоков (рис.~\ref{fig_parallel}). На текущей итерации каждый поток вычисляет свой блок матрицы производных и значений оператора. Это осуществляется путем использования директивы \#pragma omp parallel для внешних циклов.

\begin{figure}[h]
\center{\includegraphics[width=.9\textwidth]{parallel3.png}}
\caption{Разбиение данных по потокам исполнения}\label{fig_parallel}
\end{figure}

Для более эффективного использования процессорных ядер также используются возможносте наборов векторных инструкций SSE, SSE2, AVX, AVX2. Основное их преимущество --- использование особых регистров для выполнения одной и той же операции на нескольких числах одновременно (2, 4 или 8). В программном коде это выражается в использовании для внутренних циклов директива компилятора \#pragma simd для автоматического использования векторного набора инструкций.

Матрица производных имеет большую размерность (для сетки $10^3 \times 10^3$ размерность матрицы составит $10^6 \times 10^6$) и занимает значительный объем памяти (7500 ГБ). Для оптимизации работы с памятью при вычислениях используется следующий прием. Для сеток довольно большой размерности, когда данные могут не входить в оперативную память, наилучшим по быстродействию оказывается метод вычисления элементов матрицы $A'$ «на лету», т.е. вычисление значения элемента матрицы происходит в момент обращения к этому элементу без сохранения его в оперативную память. Это позволяет существенно снизить количество обращений к памяти и заметно ускорить процесс вычислений по сравнению с полным хранением матрицы и частым переключением страниц виртуальной памяти.

\newpage
\section{Реализация алгоритмов в виде комплекса программ}

Программный комплекс для решения обратных задач гравиметрии и магнитометрии о восстановлении поверхностей поверхностей раздела сред представляет собой исполняемый файл с текстовым интерфейсом. 

Для входных и выходных файлов, содержащих двумерные сеточные функции, используются форматы DAT XYZ (.dat) и Surfer Binary Grid (.grd), поддерживаемые распространенными программами.

В настоящее время модули поддерживают решение следующих задач:
\begin{enumerate}
\item Вычисление значений аномального гравитационного поля, порождаемого одной или несколькими поверхностями
\item Вычисление значений аномального магнитного поля, порождаемого одной или несколькими поверхностями для случая произвольно направленной суммарной намагниченности;
\item Восстановление одной поверхности по гравитационным данным линеаризованным методом наискорейшего спуска;
\item Восстановление одной поверхности по гравитационным данным линеаризованным методом сопряженных градиентов;
\item Восстановление одной поверхности по гравитационным данным покомпонентным методом;
\item Восстановление одной поверхности по гравитационным данным методом локальных поправок;
\item Восстановление одной поверхности по магнитным данным для случая произвольно направленной суммарной намагниченности линеаризованным методом наискорейшего спуска;
\item Восстановление одной поверхности по магнитным данным для случая произвольно направленной суммарной намагниченности линеаризованным методом сопряженных градиентов;
\item Восстановление одной поверхности по магнитным данным для случая вертикальной намагниченности покомпонентным методом;
\item Восстановление одной поверхности по магнитным данным для случая вертикальной намагниченности методом локальных поправок;
\item Восстановление нескольких поверхностей по гравитационным данным линеаризованным методом наискорейшего спуска с весовыми множителями;
\item Восстановление нескольких поверхностей по гравитационным данным линеаризованным методом минимальной ошибки с весовыми множителями;
\item Восстановление нескольких поверхностей по гравитационным данным модифицированным линеаризованным методом наискорейшего спуска с весовыми множителями;
\item Восстановление нескольких поверхностей по гравитационным данным модифицированным линеаризованным методом сопряженных градиентов с весовыми множителями;
\item Восстановление нескольких поверхностей по магнитным данным линеаризованным методом наискорейшего спуска с весовыми множителями;
\item Восстановление нескольких поверхностей по магнитным данным линеаризованным методом минимальной ошибки с весовыми множителями;
\item Восстановление нескольких поверхностей по магнитным данным модифицированным линеаризованным методом наискорейшего спуска с весовыми множителями;
\item Восстановление нескольких поверхностей по магнитным данным модифицированным линеаризованным методом сопряженных градиентов с весовыми множителями;
\item Вспомогательная задача приближенного выделения гравитационного или магнитного поля от объектов, расположенных между двумя заданными глубинами.
\end{enumerate}

Использование программы выглядит следующим образом:

\begin{lstlisting}
SurfaceProcessing <opcode>
\end{lstlisting}
, где <opcode> --- номер нужной задачи. Остальные параметры соответствуют задаче, например: 
\vspace*{32pt}
\begin{lstlisting}
SurfaceProcessing 1 L <input> <output> <h> <dsigma> [nproc]
\end{lstlisting}
, где nproc --- опциональный параметр, задающий число используемых процессорных ядер (все, если не задано), L --- число поверхностей, <input> - имя файла, со списком файлов в форматах .grd или .dat,  содержащих сеточные функции, задающие поверхности, <output> --- имя выходного файла, содержащего сеточную функцию результирующего гравитационного поля, <h> --- имя файла, содержащего список глубин залегания асимптотических плоскостей для каждой из $L$ поверхностей, <dsigma> - имя файла, содержащего список скачков плотности на каждой из поверхностей.
\vspace*{32pt}
\begin{lstlisting}
SurfaceProcessing 2 L <input> <output> <h> <dJ> [nproc]
\end{lstlisting}
, где nproc --- опциональный параметр, задающий число используемых процессорных ядер (все, если не задано), L --- число поверхностей, <input> - имя файла, со списком файлов в форматах .grd или .dat,  содержащих сеточные функции, задающие поверхности, <output> --- имя выходного файла, содержащего сеточную функцию результирующего магнитного поля, <h> --- имя файла, содержащего список глубин залегания асимптотических плоскостей для каждой из $L$ поверхностей, <dJ> - имя файла, содержащего список скачков намагниченности (по три компоненты) на каждой из поверхностей.
\vspace*{32pt}
\begin{lstlisting}
SurfaceProcessing 3..6 <input> <output> h dsigma
eps psi alpha [nproc]
\end{lstlisting}
, где nproc --- опциональный параметр, задающий число используемых процессорных ядер (все, если не задано), <input> - имя файла в формате .grd или .dat,  содержащего сеточные функции, задающие гравитационное поле, <output> --- имя выходного файла, содержащего сеточную функцию приближенной поверхности раздела, h --- глубин залегания асимптотической плоскости, dsigma - значение скачка плотности на искомой поверхности, eps --- значение относительной нормы невязки для останова процесса, psi --- значение демпфирующего параметра, alpha --- значение параметра регуляризации.
\vspace*{32pt}
\begin{lstlisting}
SurfaceProcessing 7..10 <input> <output> h dJx dJy dJz
eps psi alpha [nproc]
\end{lstlisting}
, где nproc --- опциональный параметр, задающий число используемых процессорных ядер (все, если не задано), <input> - имя файла в формате .grd или .dat,  содержащего сеточные функции, задающие магнитное поле, <output> --- имя выходного файла, содержащего сеточную функцию приближенной поверхности раздела, h --- глубин залегания асимптотической плоскости, dJx dJy dJz - значение скачка намагниченности (по три компоненты) на искомой поверхности, eps --- значение относительной нормы невязки для останова процесса, psi --- значение демпфирующего параметра, alpha --- значение параметра регуляризации.
\vspace*{32pt}
\begin{lstlisting}
SurfaceProcessing 11..14 L <input> weights_type 
<weights_input> <output> <h> <dsigma> 
eps psi beta [nproc]
\end{lstlisting}
, где nproc --- опциональный параметр, задающий число используемых процессорных ядер (все, если не задано), <input> - имя файла в формате .grd или .dat,  содержащего сеточную функцию суммарного гравитационного поля, <output> --- имя выходного файла, который будет содержать список файлов в форматах .grd или .dat с сеточными функциями восстановленных поверхностей раздела,  <h> --- имя файла, содержащего список глубин залегания асимптотических плоскостей для каждой из $L$ поверхностей, <dsigma> - имя файла, содержащего список скачков плотности на каждой из поверхностей, eps --- значение относительной нормы невязки для останова процесса, psi --- значение демпфирующего параметра, weights\_type --- тип выбора весов (0 --- разделенные поля, 1 --- нулевое приближениеповерхностей), <weights\_input> --- файл со списком файлов, содержащих входные данные для весов (разделенные поля или нулевое приближение поверхностей), beta --- сглаживающий параметр при выборе весов.
\vspace*{32pt}
\begin{lstlisting}
SurfaceProcessing 15..18 L <input> weights_type 
<weights_input> <output> <h> <dJ> 
eps psi beta [nproc]
\end{lstlisting}
, где nproc --- опциональный параметр, задающий число используемых процессорных ядер (все, если не задано), <input> - имя файла в формате .grd или .dat,  содержащего сеточную функцию суммарного магнитного поля, <output> --- имя выходного файла, который будет содержать список файлов в форматах .grd или .dat с сеточными функциями восстановленных поверхностей раздела, h --- <h> --- имя файла, содержащего список глубин залегания асимптотических плоскостей для каждой из $L$ поверхностей, <dJ> - имя файла, содержащего список скачков намагниченности (по три компоненты) на каждой из поверхностей, eps --- значение относительной нормы невязки для останова процесса, psi --- значение демпфирующего параметра, weights\_type - тип выбора весов (0 --- разделенные поля, 1 --- нулевое приближениеповерхностей), <weights\_input> --- файл со списком файлов, содержащих входные данные для весов (разделенные поля или нулевое приближение поверхностей), beta --- сглаживающий параметр при выборе весов.
\vspace*{32pt}
\begin{lstlisting}
SurfaceProcessing 19 L <input> <output> <h> 
alpha eps [nproc]
\end{lstlisting}
, где nproc --- опциональный параметр, задающий число используемых процессорных ядер (все, если не задано), L --- число поверхностей, <input> - имя файла, содержащего сеточную функцию, задающую суммарное гравитационное или магнитное поле, <output> --- имя выходного файла, содержащего список файлов с сеточными функциями разделенных полей, <h> --- имя файла, содержащего список глубин задающих слои, содержащие по одной поверхности, alpha --- параметр регуляризации, eps --- условие останова итерационного процесса решения СЛАУ при пересчете полей вниз.

Структура комплекса при решении различных видов задач приведена на рис.~\ref{cplx1} и~\ref{cplx2}.

\begin{figure}[H]
\center{\includegraphics[width=.90\textwidth]{./complex1.png}}
\caption{Структура использования комплекса при решении задач о восстановлении одной поверхности}\label{cplx1}
\end{figure}

При решении обратных задач гравиметрии и магнитометрии о восстановлении одной поверхности входными данными являются сеточная функция гравитационного или магнитного поля, глубина залегания асимптотической плоскости, разность плотностей или намагниченностей и опционально сеточная функция начального приближения поверхности. Кроме того, входными данными также являются параметры используемого алгоритма, такие как максимальное число итераций, параметр регуляризации и демпфирующий параметр и т.д.

Опциональным этапом является предварительная обработка данных с целью выделения аномального поля. На этом этапе используется методика повысотных трансформаций для исключения из правой части влияния боковых, глубинных и приповерхностных источников. Подготовленная правая часть дается на вход одному из трех алгоритмов. Выходными данными являются сеточная функция восстановленной поверхности, время выполнения программы и значения норм невязок на последовательных итерация.

\begin{figure}[H]
\center{\includegraphics[width=.90\textwidth]{./complex2.png}}
\caption{Структура использования комплекса при решении задач о восстановлении нескольких поверхностей}\label{cplx2}
\end{figure}

В случае решения задач о восстановлении нескольких поверхностей пользователю дополнительно предлагается выбор алгоритма: разделение полей и решение отдельных уравнений для каждой поверхности либо решение базового уравнения и восстановление всех поверхностей одновременно.

\subsection{Рекомендации по использованию разработанных алгоритмов}

Для решения обратных задач гравиметрии и магнитометрии о восстановлении одной поверхности раздела по сильно возмущенным данным автор рекомендует использовать регуляризованный метод сопряженных градиентов (РЛМСГ).

Для решения обратной задачи магнитометрии о восстановлении одной поверхности раздела в случае произвольно направленной суммарной намагниченности слоев рекомендуется использовать линеаризованный метод сопряженных градиентов (ЛМСГ).

Для решения задач о восстановлении одной поверхности на сетках большой размерности для ускорения вычислений рекомендуется использовать покомпонентный градиентный метод (ПГМ), который значительно снизит время счета по сравнению с другими методами.

При решении задач о восстановлении нескольких поверхностей раздела сред автор рекомендует использовать линеаризованный модифицированный метод сопряженных градиентов с весовыми множителями (ЛММСГ).

В настоящее время комплекс программ может быть установлен на любом персональном компьютере под управлением ОС Windows или\\*GNU/Linux.
 
В будущем планируется встроить комплекс программ в разработанную систему удаленных вычислений <<Специализированный веб-портал решения задач на многопроцессорных вычислительных системах>> для обеспечения доступа к выполнению программ на суперкомпьютере <<Уран>> Института математики и механики УрО РАН через веб-интерфейс (см.~\citemybib{sgvm}).

\newpage
\section{Решение модельных задач с анализом параллелизма}
\subsection{Оценки ускорения и эффективности параллельных алгоритмов}
Для исследования параллельных свойств и сравнения работы последовательных и параллельных алгоритмов вводятся некоторые характеристики. Основные --- это коэффициенты ускорения и эффективности:
\begin{equation}\nonumber
\begin{aligned}
S_m=\frac{T_1}{T_m},\\[16pt]
\quad E_m=\frac{S_m}{m},
\end{aligned}
\end{equation}
где 
$T_1$ --- время выполнения последовательного алгоритма на одном
процессорном ядре,
$T_m$ --- время выполнения параллельного алгоритма на $m$ ($m>1$) ядрах процессора.

$T_m$ представляет собой совокупность чистого времени счета 
и накладных расходов на создание и синхронизацию потоков исполнения $$T_m=T_c+T_o.$$
 
Число процессорных ядер $m$ соответствует упомянутому разбиению матрицы и векторов на $m$ фрагментов.

В общем случае эффективность распараллеливания $E_m$ меняется в пределах $0<E_m<1$. В идеальном случае при равномерной и сбалансированной загрузке процессорных ядер и минимальном времени на накладные расходы $E_m$ близко к единице, но при решении практических задач  она уменьшается за счет накладных расходов и дисбаланса нагрузки.

Oсновной целью при построении параллельных алгоритмов является получение максимального ускорения и эффективности:
\begin{equation}\nonumber
\begin{aligned}
S_m \rightarrow m, \\[16pt]
E_m \rightarrow 1.
\end{aligned}
\end{equation}

Условиями высокой эффективности являются:

1) равномерная загрузка процессорных ядер (отсутствие простоев);

2) масштабируемость параллельного алгоритма (возможность ускорения вычислений
пропорционально увеличению числа используемых процессорных ядер).

\newpage
\subsection{Задача 1: Восстановление одной поверхности раздела по модельным гравитационным данным}
\begin{figure}[h]
\center{\includegraphics[width=.9\textwidth]{./m3_geo_field.png}}
\caption{Гравитационное поле}\label{fig31}
\end{figure}
Эксперимент проводился для сравнения методов решения обратной задачи о восстановлении одной поверхности раздела по относительной погрешности $\delta = {\left \| z-\bar{z} \right \|^2}/{\left \|\bar{z} \right\|^2}$, где $z$ --- приближенное решение, $\bar{z}$ --- исходная поверхность, и времени счета.

Исходная поверхность $\bar{z}$ приведена на рис.~\ref{fig32}. По модельному гравитационному полю со внесенным шумом с уровнем 10\% от максимального значения поля (рис.~\ref{fig31}) на площади $256 \times 256 \textup{ км}^2$ была восстановлена плотностная границы с асимптотой $H=6\textup{ км}$ и скачком плотности $\Delta \sigma=0,1 \textup{ г/см}^3$. Задача была решена четырьмя методами на 1 и 8 ядрах процессора Intel Xeon E5-2660 (2.2 GHz):
\begin{itemize}
\item линеаризованный метод наискорейшего спуска (РЛМНС)~\cite{engl_hanke1996reg} со значениями параметров $\psi=1,      \alpha=10^{-4}$;
\item линеаризованный метод сопряженных градиентов (РЛМСГ)~\eqref{eq9} со значениями параметров $\psi=1,      \alpha=10^{-4}$;
\item метод локальных поправок (РМЛП)~\cite{martyshko2010} со значениями параметров $\alpha=10^{-2}$;
\item покомпонентный градиентный метод (РПГМ)~\eqref{process_cw} со значениями параметров $\psi=0.05,    \alpha=10^{-4}$.
\end{itemize}

Условием останова было выбрано ${\left \| A(z)-F \right \|^2}/{\left \| F \right \|^2}<\varepsilon = 5 \cdot 10^{-2}$. 

Значения параметров подбирались экспериментальным способом --- максимальное значение, при котором норма невязки на последовательных итерациях уменьшается.

На рис.~\ref{fig32} приведена поверхность раздела, восстановленная методом ЛМСГ.

\begin{figure}[h]
\center{\includegraphics[width=.9\textwidth]{./m3_geo_orig.png}}
\caption{Исходная поверхность}\label{fig32orig}
\end{figure}
 
\begin{figure}[h]
\center{\includegraphics[width=.7\textwidth]{./m3_geo_recon.png}}
\caption{Восстановленная поверхность}\label{fig32}
\end{figure}

В таблице~\ref{table:1} приведены названия методов, время выполнения на одном $T_1$ и восьми $T_8$ ядрах процессора, ускорение $S_8$ и эффективность $E_8$ параллельного алгоритма при использовании восьми ядер. Размер сетки составлял $2^{10} \times 2^{10}$, размер матрицы производных при этом $2^{20} \times 2^{20}$.

\begin{table}[H]
  \centering
%  \renewcommand{\arraystretch}{1.5}
$$
\begin{tabular}{|c|c|c|c|c|c|c|}
\hline
Метод & \begin{tabular}[c]{@{}c@{}}Число\\ итераций\end{tabular} & $\delta$ & $T_1$   & $T_8$    & \begin{tabular}[c]{@{}c@{}}Ускорение \\ $S_8$\end{tabular} & \begin{tabular}[c]{@{}c@{}}Эффективность\\ $E_8$\end{tabular} \\ \hline
РЛМНС & 80                                                       & 0.1      & 68 мин. & 8.6 мин. & 7.9                                                        & 0.98                                                          \\ \hline
РЛМСГ & 20                                                       & 0.1      & 17 мин. & 2 мин.   & 7.8                                                        & 0.97                                                          \\ \hline
РМЛП  & 60                                                       & 0.4      & 36 мин. & 4.6 мин. & 7.33                                                       & 0.92                                                          \\ \hline
РПГМ  & 40                                                       & 0.25     & 25 мин. & 3.3 мин. & 7.5                                                        & 0.93                                                          \\ \hline
\end{tabular}
$$
\caption{Результаты численных экспериментов}\label{table:1}
\end{table}

\textbf{Вывод.} Эксперименты показали, что линеаризованный метод сопряженных градиентов при подходящем подборе параметров дает наилучший по погрешности результат. Покомпонентный градиентный метод дает время, сравнимое с методом локальный поправок при сравнимой точности. Результаты данного эксперимента опубликованы в работе \citemybib{my_kiev2016reg}.

\newpage
\subsection{Задача 2: Восстановление модельной поверхности <<параллелепипед>> по магнитным данным в случае произвольно направленной суммарной намагниченности}

Эксперимент проводился для демонстрации неоднозначности и важности учета направления разности намагниченностей слоев при решении структурной обратной задачи магнитометрии о восстановлении поверхности раздела.

По заданной функции поверхности (точное решение задачи) (рис.~\ref{fig_pp2orig}) \\* $z=-10+3e^{-(x/15)^{20}-(y/15)^{20}} \textup{ км}$ c асимптотической плоскостью $h=10\textup{ км}$ была решена прямая задача и найдено магнитное поле при разнице намагниченностей $\Delta \boldsymbol{J}=(-2;2;1) \textup{ А}/\textup{м}$ (рис.~\ref{fig_pp2field}).

\begin{figure}[H]
\center{\includegraphics[height=.33\textheight]{problem2_cube_orig.png}}
\caption{Исходная поверхность (точное решение)}\label{fig_pp2orig}
\end{figure}

\begin{figure}[H]
\center{\includegraphics[height=.33\textheight]{problem2_cube_field.png}}
\caption{Модельное магнитное поле}\label{fig_pp2field}
\end{figure}

Затем по данному полю было решено несколько обратных задач и восстановлены поверхности, при этом брались различные значения скачка намагниченности. 

На рис.~\ref{fig_pp2vert} представлено решение, полученное при предположении, что разность намагниченностей вертикальна $\Delta \boldsymbol{J}=(0;0;1) \textup{ А}/\textup{м}$, т.~е., пытаясь решить уравнение~\eqref{eq1magn}.

На рис.~\ref{fig_pp2true} представлено решение, полученное при решении уравнения~\eqref{eq1magnarb} при $\Delta \boldsymbol{J}=(-2;2;1) \textup{ А}/\textup{м}$.

%На рис.~\ref{fig_pp2horz} представлено решение, полученное при $\Delta \boldsymbol{J}=(-2;2;0) \textup{ А}/\textup{м}$ (горизонтальная намагниченность).

При этом при верном выборе $\Delta \boldsymbol{J}=(-2;2;1) \textup{ А}/\textup{м}$ для достижения относительной нормы невязки $\varepsilon=0,005$ потребовалось 20 итераций, а неверном выборе и попытке решения уравнения для случая вертикально направленной намагниченности норма невязки $\varepsilon=0,05$ достигалась более чем за 500 итераций.


\begin{figure}[H]
\center{\includegraphics[height=.30\textheight]{problem2_cube_vert.png}}
\caption{Восстановленная поверхность при $\Delta \boldsymbol{J}=(0;0;1) \textup{ А}/\textup{м}$}\label{fig_pp2vert}
\end{figure}

%\begin{figure}[H]
%\center{\includegraphics[height=.33\textheight]{problem2_cube_horz.png}}
%\caption{Восстановленная поверхность при $\Delta \boldsymbol{J}=(-2;2;0) \textup{ А}/\textup{м}$}\label{fig_pp2horz}
%\end{figure}

\begin{figure}[H]
\center{\includegraphics[height=.30\textheight]{problem2_cube_true.png}}
\caption{Восстановленная поверхность при $\Delta \boldsymbol{J}=(-2;2;1) \textup{ А}/\textup{м}$}\label{fig_pp2true}
\end{figure}

\textbf{Вывод.} Проведенный эксперимент показывает, что учет направления намагниченности важен и значительно влияет как на получаемое решение, так и на скорость сходимости и устойчивость задачи. При попытке решения задачи в предположении случая только вертикальной намагниченности можно получить решение, дающее некоторое уменьшение невязки по правой части, но значительно отличающееся от истинного.

%\leavevmode\thispagestyle{empty}\newpage
\newpage
\subsection{Задача 3: Восстановление поверхности раздела сред по модельным магнитным данным в случае произвольно направленной суммарной намагниченности}

Эксперимент проводился для оценки времени счета и анализа ускорения и эффективности разработанного алгоритма решения обратной задачи магнитометрии о восстановлении поверхности раздела в случае произвольно направленной намагниченностей.

По заданной функции поверхности (точное решение задачи) (рис.~\ref{fig_p2a}) \\* $z=10+sin(x/10)cos(y/20)e^{-(x/60)^2 -(y/60)^2} \textup{ км}$ с асимптотической плоскостью $h=10\textup{ км}$ и разницей намагниченностей $\Delta \boldsymbol{J}=(0,57;0,57;0,57) \textup{ А}/\textup{м}$ была решена прямая задача и получено магнитное поле (рис.~\ref{fig_p2b}). Для решения обратной задачи использовался линеаризованный метод сопряженных градиентов с условием останова $\varepsilon = 0.01$. Вычисление потребовало 7 итераций. 

На рис.~\ref{fig_p2c} показана восстановленная поверхность. Относительная погрешность $\delta$ составила $0.01$.

В таблице~\ref{table:2} приведены времена выполнения, ускорение и эффективность параллельного алгоритма, выполняемого на восьмиядерном процессоре Intel Xeon E5-2660 (2.2 ГГц). 

На рис.~\ref{fig_p2d} показаны графики ускорения и эффективности в зависимости от числа использованных процессорных ядер. Задача решалась на сетке $2^{10} \times 2^{10}$, при этом размер матрицы производных составил $2^{20} \times 2^{20}$.

\begin{figure}[H]
\center{\includegraphics[height=.33\textheight]{model2_field.png}}
\caption{Магнитное поле}\label{fig_p2b}
\end{figure}

\begin{table}[H]
\centering
%\renewcommand{\arraystretch}{1.5}
$$
\begin{tabular}{|c|c|c|c|}
\hline
\begin{tabular}[c]{@{}c@{}}Число\\ ядер $m$\end{tabular} & \begin{tabular}[c]{@{}c@{}}Время,\\ мин.\end{tabular} & \begin{tabular}[c]{@{}c@{}}Ускорение\\  $S_m$\end{tabular} & \begin{tabular}[c]{@{}c@{}}Эффективность\\  $E_m$\end{tabular} \\ \hline
1                                                        & 180                                                   &                                                            &                                                                \\ \hline
2                                                        & 91                                                    & 1,98                                                       & 0,99                                                           \\ \hline
3                                                        & 61                                                    & 2,94                                                       & 0,98                                                           \\ \hline
4                                                        & 46                                                    & 3,88                                                       & 0,97                                                           \\ \hline
5                                                        & 38                                                    & 4,75                                                       & 0,95                                                           \\ \hline
6                                                        & 32                                                    & 5,64                                                       & 0,94                                                           \\ \hline
7                                                        & 28                                                    & 6,44                                                       & 0,92                                                           \\ \hline
8                                                        & 25                                                    & 7,2                                                        & 0,9                                                            \\ \hline
\end{tabular}$$
\caption{Результаты численных экспериментов}\label{table:2}
\end{table}



\begin{figure}[H]
\center{\includegraphics[height=.33\textheight]{model2_surf.png}}
\caption{Исходная поверхность}\label{fig_p2a}
\end{figure}

\begin{figure}[H]
\center{\includegraphics[height=.33\textheight]{model2_surf.png}}
\caption{Восстановленная поверхность}\label{fig_p2c}
\end{figure}


\begin{figure}[H]
\center{\includegraphics[height=.66\textheight]{model2_graphs.png}}
\caption{Зависимость ускорения $S_m$ и эффективности $E_m$ от числа ядер $m$}\label{fig_p2d}
\end{figure}

%Проведенный эксперимент показывает, что учет направления намагниченности важен, и при различных входных данный возможны сильно отличающиеся решения. 

\textbf{Вывод.} Разработанный алгоритм на основе линеаризованного метода сопряженный градиентов позволяет решать структурную обратную задачу магнитометрии о восстановлении поверхности раздела в случае произвольно направленной суммарной намагниченности. Эксперимент демонстрирует высокую эффективность разработанного параллельного алгоритма и программы. %Результаты данного эксперимента опубликованы в \citemybib{my_kiev2016magn}.


\leavevmode\thispagestyle{empty}\newpage
\subsection{Задача 4: Восстановление двух поверхностей по модельным гравитационным данным}

Эксперимент проводился для демонстрации неоднозначности при решении базовых интегральных уравнений структурных обратных задач гравиметрии и магнитометрии о восстановлении нескольких поверхностей.

Рассматривается струрная задача гравиметрии для трехслойной среды, разделенной двумя поверхностями. Суммарное гравитационное поле (рис.~\ref{fig4field}) находилось путем решения прямой задачи гравиметрии с известными поверхностями (рис.~\ref{fig4surforig}). Поверхности имеют асимптотические плоскости $H_1=5 \textup{ км}, H_2=20\textup{ км}$. Скачки плотности брались равными $\Delta \sigma_1=0,21 \lbcomma \Delta \sigma_2=0,07 \textup{ г/см}^3$.

\begin{figure}[H]
\center{\includegraphics[height=.4\textheight]{4_field_sum_coloured.png}}
\caption{Суммарное гравитационное поле}\label{fig4field}
\end{figure}

\begin{figure}[H]
\center{\includegraphics[width=.95\textwidth]{4_boundaries_colored_exact.png}}
\caption{Исходные поверхности}\label{fig4surforig}
\end{figure}


На рис.~\ref{fig4nw} и~\ref{fig4w} представлены 2 варианта решения — без использования весовых множителей и с использованием весовых множителей. Оба решения дают относительную норму невязки по правой части $\varepsilon=0,001$. Погрешность поверхностей, восстановленных с использованием весовых множителей, составила 3 \%, в то время как для поверхностей, восстановленных без использования весовых множителей, приближенное решение значительно отличается от точного и погрешности составили 20\%.

\begin{figure}[H]
\center{\includegraphics[width=.95\textwidth]{boundaries_colored_____.png}}
\caption{Поверхности, восстановленные без использования весовых множителей}\label{fig4nw}
\end{figure}

\begin{figure}[H]
\center{\includegraphics[width=.95\textwidth]{boundaries_colored_z.png}}
\caption{Поверхности, восстановленные с использованием весовых множителей}\label{fig4w}
\end{figure}

\textbf{Вывод.} Эксперименты показывают, что решение задачи о восстановлении нескольких поверхностей не является единственным, полученные решения могут значительно различаться. Алгоритм, использующий весовые множители, позволяет получить решение, близкое к истинному.

\newpage
\subsection{Задача 5: Восстановление двух поверхностей по модельным магнитным данным}

Эксперимент проводился для сравнения традиционного алгоритма (разделение суммарное поля на составляющие и независимое восстановление каждой поверхности) и нового алгоритма (восстановление всех поверхностей одновременно из базового уравнения).

Рассматривается структурная задача магнитометрии для трехслойной среды, разделенной двумя поверхностями, заданными на площади $90\times 100 \textnormal{ км}^2$. Суммарное магнитное поле находилось путем решения прямой задачи магнитометрии с известными поверхностями (рис.~\ref{fig33}). Две поверхности с асимптотами $H_1=5 \textup{ км}, H_2=20\textup{ км}$. Скачки намагниченности брались равными $\Delta J_{z,1}=0,2 \textup{ А/м}, \Delta J_{z,2}=0,2 \textup{ А/м}$. 

Задача решалась с использованием двух алгоритмов --- традиционного и нового, с использованием линеаризованного метода наискорейшего спуска с весовыми множителями. Условием останова было было $\varepsilon = 0,1$. Кроме того, решена задача восстановления двух поверхностей по полю со внесенным белым шумом амплитудой в 15\%. 

На рис.~\ref{fig35} приведены поверхности, восстановленные по полю без шума, а на рис.~\ref{fig36} --- по зашумленному полю.

В таблице~\ref{table:4} приведены $T_1, T_8$ --- времена выполнения на 1 и на 8 ядрах процессора Intel Xeon X5675, число итераций для задачи с зашумленным полем. 

$\delta = \left \| \bar{z} - z  \right \|/\left \| \bar{z} \right \| $ — относительные погрешности по первой и второй поверхностям. 

Задача решалась на сетке $2^8 \times 2^8$, при этом размер матрицы производных составил $65536 \times 65536$.

\begin{table}[H]
  \centering
  \renewcommand{\arraystretch}{1.5}
$$
\begin{tabular}{|c|c|c|c|c|c|}\hline
Алгоритм & $\delta_1$  & $\delta_2$ & Число итераций & $T_1$& $T_8$  \\ \hline
%\rowcolor{Red}
Трад. алгоритм & 0.061 & 0.056 & 89 & 5.5 часа & 39 мин. \\ \hline
%\rowcolor{Green}
Новый алгоритм  & 0.038 & 0.039 & 39 & 2.5 часа & 21 мин. \\ \hline
%1&2&3&4&5&6
\end{tabular}
$$
\caption{Результаты численных экспериментов}\label{table:4}
\end{table}

\begin{figure}[H]
\center{\includegraphics[height=.6\textheight]{mod3_origs.png}}
\caption{Исходные поверхности}\label{fig33}
\end{figure}

\begin{figure}[H]
\center{\includegraphics[width=.8\textwidth]{mod3_fields.png}}
\caption{Суммарные магнитные поля}\label{fig34}
\end{figure}

\begin{figure}[H]
\center{\includegraphics[width=.8\textwidth]{mod3_sol1.png}}
\caption{Поверхности, восстановленные по полю без шума}\label{fig35}
\end{figure}

\begin{figure}[H]
\center{\includegraphics[width=.8\textwidth]{mod3_sol2.png}}
\caption{Поверхности, восстановленные по зашумленному полю}\label{fig36}
\end{figure}

\textbf{Вывод.} Эксперимент показывает, что использование нового алгоритма в два раза снижает время выполнения, при этом несколько повышая точность полученного решения в случае возмущенных данных. %Результаты данного эксперимента опубликованы в работах \citemybib{ugatu2}.

\newpage
\subsection{Задача 6: Восстановление трех поверхностей по реальным гравитационным данным}

\begin{figure}[h]
\center{\includegraphics[width=.95\textwidth]{./mod4_field.png}}
\caption{Суммарное гравитационное поле}\label{fig10}
\end{figure}

Эксперименты проводились для сравнения традиционного алгоритма --- разделение гравитационного поля на составляющие с последующим независимым решением задач о восстановлении одной границы --- и нового --- решение базового интегрального уравнения с восстановлением нескольких границ одновременно. 

Для восточной части Среднего Урала по реальным наблюденным данным (рис.~\ref{fig10}), измеренным на площади $62\times 145,75 \textnormal{ км}^2$, для модели четырехслойной среды решена структурная задача гравиметрии о нахождении поверхностей раздела сред $\zeta_1 \lbcomma \zeta_2 \lbcomma \zeta_3$ со скачками плотности $\Delta \sigma_1=0,3 \lbcomma \Delta \sigma_2=0,2 \lbcomma \Delta \sigma_3=0,1 \textnormal{ г/см}^3$. Расстояния до асимптотических плоскостей принимались равными $H_1=15 \lbcomma H_2=20 \lbcomma H_3=25 \textnormal{ км}$. 

После дискретизации уравнения~\eqref{eq1_sumgrav} на сетке $82\times 108$ имеем результирующий вектор решения $z$ размерности $35424$ и матрицу $A'(z^k)^T$ размерности $35424\times 8856$.

Задача решена на 6 ядрах процессора Intel традиционным алгоритмом и новым --- в обоих случаях с помощью метода ЛМНС с весовыми множителями при --- с помощью метода ЛМНС с $\psi=0,05$ и $\beta=1,4$. При этом в обоих случаях относительная норма невязки $\varepsilon=0,15$ по сравнению с начальной $\varepsilon_0=1$ уменьшилась на два порядка. 

На рис.~\ref{fig11} и~\ref{fig12} приведены результаты, полученные традиционным и новым алгоритмом. %На рис.~\ref{fig13} приведен разрез, показывающий, что результаты, полученные разными алгоритмами, качественно схожи.

%\begin{figure}[h]
%\center{\includegraphics[width = 0.8\textwidth]{m4_slice.jpg}}
%\caption{Разрез по линии $y=46\textup{км}$}\label{fig13}
%\end{figure}

В таблице~\ref{table:5} приведены результаты эксперимента. Число итераций (в случае традиционного алгоритма суммарное число итераций, потраченных на восстановление трех поверхностей), $T$ --- время выполнения последовательной программы. 

\begin{table}[h]
  \centering
  \renewcommand{\arraystretch}{1.5}
$$
\begin{tabular}{|c|c|c|c|}\hline
Алгоритм  & $\varepsilon$  & Число итераций & $T$ \\ \hline
Традиционный  & 0,015 & 288 & 102 c \\ \hline
%\rowcolor{Green}
Новый   & 0,015 & 70 & 73 c \\ \hline
\end{tabular}
$$
\caption{Результаты численных экспериментов}\label{table:5}
\end{table}

\textbf{Вывод.} Результаты эксперимента показывает, что новый алгоритм, предлагаемый автором, дает результаты, сравнимые с традиционным при меньшем времени выполнения. Результаты решения задачи опубликованы в работе \citemybib{dan13}.

\newpage

\begin{figure}[H]
    \center{\includegraphics[width = 0.75\textwidth]{./m4old_b1.png}} \\
	\center{\includegraphics[width = 0.75\textwidth]{./m4old_b2.png}} \\
	\center{\includegraphics[width = 0.75\textwidth]{./m4old_b3.png}} \\
	\caption{Поверхности, восстановленные традиционным алгоритмом}\label{fig11}
\end{figure}

\newpage

\begin{figure}[H]
	\center{\includegraphics[width = 0.75\textwidth]{./m4new_b1.png}} \\
	\center{\includegraphics[width = 0.75\textwidth]{./m4new_b2.png}} \\
	\center{\includegraphics[width = 0.75\textwidth]{./m4new_b3.png}} \\
	\caption{Поверхности, восстановленные новым алгоритмом}\label{fig12}
\end{figure}

\newpage
\subsection{Задача 7: Восстановление трех поверхностей по реальным гравитационным данным}
 
В рамках модели четырехслойной среды по реальным гравитационным данным решена структурная обратная задача о нахождении трех плотностных границ. Из наблюденного гравитационного поля было выделено поле на площади $360\times 636 \textnormal{ км}^2$, соответствующее массам, расположенным между глубинами $5$ и $50$ км. Для получения весовых множителей и начальных приближений предварительно из суммарного поля на сетке $25\times 25$ были выделены поля, соответствующие трем искомым границам. По суммарному полю восстановлены границы с асимптотическими плоскостями $H_1=8 \lbcomma H_2=15 \lbcomma H_3=30 \textnormal{ км}$, скачки плотностей на которых принимались $\Delta \sigma_1=0,2 \lbcomma \Delta \sigma_2=0,15 \lbcomma \Delta \sigma_3=0,1 \textnormal{ г/см}^3$.

\begin{figure}[h]
\center{\includegraphics[width=.95\textwidth]{./model5_field.png}}
\caption{Суммарное гравитационное поле}\label{fig14}
\end{figure}

На рис.~\ref{fig14} изображено суммарное аномальное гравитационное поле. На рис.~\ref{fig15} и~\ref{fig15a} изображены восстановленные плотностные границы и порождаемые ими поля.

\begin{figure}[h]
\center{\includegraphics[height=.65\textheight]{./model5_solution.png}}
\caption{Найденные поверхности раздела}\label{fig15}
\end{figure}

\begin{figure}[h]
\center{\includegraphics[height=.65\textheight]{./model5_solfields.png}}
\caption{Гравитационные поля, порождаемые полученными поверхностями}\label{fig15a}
\end{figure}

Задача решена на восьмиядерном процессоре Intel Xeon E5-2660 (2.2 ГГц) с помощью параллельных методов наискорейшего спуска ЛМНС~\eqref{eq5} с весовыми множителями и их модифицированных вариантов ЛММНС~\eqref{eq7} и ЛММСГ~\eqref{eq10}. Условием останова являлось уменьшение относительной нормы невязки до $\varepsilon \leqslant 0,05$, демпфирующий параметр принимался равным $\psi=1$, сглаживающий параметр $\beta=1,4$ качестве начальных приближений $\hat{Z}$ брались границы, полученные путем решения задачи восстановления одной границы по соответствующему ей выделенному полю на сетке $25\times 25$. 

После дискретизации уравнения~\eqref{eq1_sumgrav} на сетки $168 \times 256$ имеем матрицу производных размерности $43008 \times 129024$. В таблице~\ref{table:6} представлено сравнение методов по числу итераций и времени счета. В первом столбце таблицы приводятся методы решения, во втором – число итераций, в третьем и четвертом столбцах – времена решения задачи $T_1$ и $T_8$ на одном ядре и 8 ядрах процессора.

\begin{table}[H]
  \centering
%  \renewcommand{\arraystretch}{1.5}
$$
\begin{tabular}{|c|c|c|c|}\hline
Метод  & Число итераций  & $T_1$ & $T_8$ \\ \hline
ЛМНС  & 200 & 8.7 часа & 67 мин \\ \hline
ЛММНС  & 171 & 7.5 часа & 57.4 мин \\ \hline
ЛММСГ  & 31 & 1.4 часа & 10.4 мин \\ \hline
\end{tabular}
$$
\caption{Результаты численных экспериментов}\label{table:6}
\end{table}

\textbf{Вывод.} Построен пример решения практической задачи о восстановлении трех плотностных контактов по реальным гравитационным данным. Линеаризованный модифицированный метод сопряженных градиентов является наиболее экономичным по времени из предложенных в диссертационной работе. Результаты опубликованы в работе~\citemybib{fze16}.

%\leavevmode\thispagestyle{empty}\newpage